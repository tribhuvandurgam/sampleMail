/**
 * @class
 * @name SBW
 * @classdesc Namespace for Model,Controller and Views
 * @module SocialByWay
 * @namespace SBW
 */
function hex_sha1(e){return binb2hex(core_sha1(str2binb(e),e.length*chrsz))}function b64_sha1(e){return binb2b64(core_sha1(str2binb(e),e.length*chrsz))}function str_sha1(e){return binb2str(core_sha1(str2binb(e),e.length*chrsz))}function hex_hmac_sha1(e,t){return binb2hex(core_hmac_sha1(e,t))}function b64_hmac_sha1(e,t){return binb2b64(core_hmac_sha1(e,t))}function str_hmac_sha1(e,t){return binb2str(core_hmac_sha1(e,t))}function sha1_vm_test(){return hex_sha1("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function core_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n=Array(80),r=1732584193,i=-271733879,s=-1732584194,o=271733878,u=-1009589776;for(var a=0;a<e.length;a+=16){var f=r,l=i,c=s,h=o,p=u;for(var d=0;d<80;d++){d<16?n[d]=e[a+d]:n[d]=rol(n[d-3]^n[d-8]^n[d-14]^n[d-16],1);var v=safe_add(safe_add(rol(r,5),sha1_ft(d,i,s,o)),safe_add(safe_add(u,n[d]),sha1_kt(d)));u=o,o=s,s=rol(i,30),i=r,r=v}r=safe_add(r,f),i=safe_add(i,l),s=safe_add(s,c),o=safe_add(o,h),u=safe_add(u,p)}return Array(r,i,s,o,u)}function sha1_ft(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function sha1_kt(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function core_hmac_sha1(e,t){var n=str2binb(e);n.length>16&&(n=core_sha1(n,e.length*chrsz));var r=Array(16),i=Array(16);for(var s=0;s<16;s++)r[s]=n[s]^909522486,i[s]=n[s]^1549556828;var o=core_sha1(r.concat(str2binb(t)),512+t.length*chrsz);return core_sha1(i.concat(o),672)}function safe_add(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function rol(e,t){return e<<t|e>>>32-t}function str2binb(e){var t=Array(),n=(1<<chrsz)-1;for(var r=0;r<e.length*chrsz;r+=chrsz)t[r>>5]|=(e.charCodeAt(r/chrsz)&n)<<32-chrsz-r%32;return t}function binb2str(e){var t="",n=(1<<chrsz)-1;for(var r=0;r<e.length*32;r+=chrsz)t+=String.fromCharCode(e[r>>5]>>>32-chrsz-r%32&n);return t}function binb2hex(e){var t=hexcase?"0123456789ABCDEF":"0123456789abcdef",n="";for(var r=0;r<e.length*4;r++)n+=t.charAt(e[r>>2]>>(3-r%4)*8+4&15)+t.charAt(e[r>>2]>>(3-r%4)*8&15);return n}function binb2b64(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="";for(var r=0;r<e.length*4;r+=3){var i=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255;for(var s=0;s<4;s++)r*8+s*6>e.length*32?n+=b64pad:n+=t.charAt(i>>6*(3-s)&63)}return n}function sha256(e){e=sha256Pad(e);var t=sha256Init.slice(0),n=e.length,r=0;do{var i=r+16;sha256Round(t,e.slice(r,i)),r=i}while(r<n);var s=[];n=t.length;for(var o=0;o<n;o++){var u=t[o];s.push(u>>>24&255),s.push(u>>>16&255),s.push(u>>>8&255),s.push(u&255)}return s}function sha256Pad(e){var t=e.length*8,n=(e.length+72&-64)-8;e=e.concat(sha256Tail.slice(0,n-e.length));var r=[],i=0;do{var s=e[i++]<<24;s|=e[i++]<<16,s|=e[i++]<<8,s|=e[i++],r.push(s)}while(i<n);return r.push(0),r.push(t),r}function sha256Round(e,t){for(var n=16;n<64;n++){var r=t[n-15],i=t[n-2],s=r>>>7|r<<25,o=r>>>18|r<<14,u=i>>>17|i<<15,a=i>>>19|i<<13,f=s^o^r>>>3,l=u^a^i>>>10;t.push(t[n-16]+f+t[n-7]+l&-1)}var c=e[0],h=e[1],p=e[2],d=e[3],v=e[4],m=e[5],g=e[6],y=e[7];for(n=0;n<64;n++){var b=c>>>2|c<<30,w=c>>>13|c<<19,E=c>>>22|c<<10,S=v>>>6|v<<26,x=v>>>11|v<<21,T=v>>>25|v<<7,N=b^w^E,C=c&h^c&p^h&p,k=N+C,L=S^x^T,A=v&m^~v&g,O=y+L+A+sha256Roots[n]+t[n];y=g,g=m,m=v,v=d+O&-1,d=p,p=h,h=c,c=O+k&-1}e[0]=e[0]+c&-1,e[1]=e[1]+h&-1,e[2]=e[2]+p&-1,e[3]=e[3]+d&-1,e[4]=e[4]+v&-1,e[5]=e[5]+m&-1,e[6]=e[6]+g&-1,e[7]=e[7]+y&-1}var SBW=SBW||{};SBW.Models=SBW.Models||{},SBW.Controllers=SBW.Controllers||{},SBW.Views=SBW.Views||{},SBW.Controllers.Services=SBW.Controllers.Services||{},SBW.Singletons=SBW.Singletons||{},SBW.registerNamespace=function(e){var t=e.split("."),n=SBW,r="";for(var i=0,s=t.length;i<s;i++)r=t[i],n[r]=n[r]||{},n=n[r];return n},SBW.Object=function(){},SBW.Object.extend=function(e,t){var n=SBW.Object.prototype.extend;SBW.Object._prototyping=!0;var r=new this;n.call(r,e),r.base=function(){},delete SBW.Object._prototyping;var i=r.constructor,s=r.constructor=function(){if(!SBW.Object._prototyping)if(this._constructing||this.constructor==s)this._constructing=!0,i.apply(this,arguments),delete this._constructing;else if(arguments[0]!=null)return(arguments[0].extend||n).call(arguments[0],r)};return s.ancestor=this,s.extend=this.extend,s.forEach=this.forEach,s.implement=this.implement,s.set=this.set,s.get=this.get,s.prototype=r,s.toString=this.toString,s.valueOf=function(e){return e=="object"?s:i.valueOf()},n.call(s,t),typeof s.init=="function"&&s.init(),s},SBW.Object.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&typeof t=="function"&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/SBW.\bbase\b/.test(t)){var r=t.valueOf();t=function(){var e=this.parent||SBW.Object.prototype.base;this.parent=n;var t=r.apply(this,arguments);return this.parent=e,t},t.valueOf=function(e){return e=="object"?t:r},t.toString=SBW.Object.toString}this[e]=t}else if(e){var i=SBW.Object.prototype.extend;!SBW.Object._prototyping&&typeof this!="function"&&(i=this.extend||i);var s={toSource:null},o=["constructor","toString","valueOf"],u=SBW.Object._prototyping?0:1;while(a=o[u++])e[a]!=s[a]&&i.call(this,a,e[a]);for(var a in e)s[a]||i.call(this,a,e[a])}return this},set:function(e,t){this[e]=t},get:function(e){return this[e]}},SBW.Object=SBW.Object.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var r in e)this.prototype[r]===undefined&&t.call(n,e[r],r,e)},implement:function(){for(var e=0;e<arguments.length;e++)typeof arguments[e]=="function"?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),SBW.Logger=SBW.Object.extend({DISPLAY:{name:"Display",level:1},ERROR:{name:"Error",level:2},SUCCESS:{name:"Success",level:3},INFO:{name:"Info",level:4},DEBUG:{name:"Debug",level:5},on:!1,log:function(e,t){var n=this;window.jasmine||console.log&&n.on&&console.log("["+e.name+"] "+t)},debug:function(e){this.log(this.DEBUG,e)},info:function(e){this.log(this.INFO,e)},error:function(e){this.log(this.ERROR,e)},logDisplay:function(e){this.log(this.DISPLAY,e)}}),function(){"use strict";SBW.Utils=SBW.Object.extend({xmlHttpObj:null,getSelectedCheckboxValue:function(e){var t=[],n,r=this.getCheckBoxElements(e);if(r.length>0)for(n=0;n<r.length;n+=1)r[n].checked&&(t[n]=r[n].value);return t},getCheckBoxElements:function(e){var t=[],n,r;if(e){r=e.getElementsByTagName("input");for(n=0;n<r.length;n+=1)r[n].type==="checkbox"&&(t[t.length]=r[n])}return t},createXmlHttpObj:function(){var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=t.length;for(e=0;e<n;e++)try{this.xmlHttpObj=t[e]()}catch(r){this.xmlHttpObj=null}return this.xmlHttpObj},ajax:function(e,t,n){$.support.cors=!0,$.ajax({url:e.url,data:e.data,cache:e.cache,contentType:e.contentType,processData:e.processData,crossDomain:e.crossDomain||!0,type:e.type||"GET",dataType:e.dataType,beforeSend:function(t,n){e.customHeaders&&$.each(e.customHeaders,function(e,n){t.setRequestHeader(e,n)})},success:function(e){t(e)},error:function(e){n(e)}})},getJSONFromQueryParams:function(e){var t=[],n,r=e.contents||e,i;r=r.split("&");for(i=0;i<r.length;i+=1)n=r[i].split("="),t.push(n[0]),t[$.trim(n[0])]=$.trim(n[1]);return t},callbackURLForService:function(e){var t=this._wwwLocation();return t.protocol+"//"+t.host+SBW.Singletons.config.callbackDirectory+"/callback"+e+".html"},_wwwLocation:function(){var e="www"+location.host.substr(location.host.indexOf("."));return{protocol:location.protocol,host:e}},isType:function(e,t){var n=e?e.constructor:undefined;return n===t},forEach:function(e,t){var n=e.length,r;if(this.isType(e,Array)&&this.isType(t,Function))for(r=0;r<n;r++)r in e&&t.call(e,e[r],r,e)},getMetaForUrl:function(e,t,n){var r=this;r.ajax({url:SBW.Singletons.config.proxyURL+"?url="+encodeURIComponent(e),contentType:"text",type:"GET"},function(n){var r=$.parseHTML(n)||[],i={};r.forEach(function(t,n,r){i.url=e;if(t.nodeName.toLowerCase()==="meta"){var s=t.attributes,o;for(o=0;o<s.length;o++)s[o].value.toLowerCase()==="og:description"?i.description=t.content:s[o].value.toLowerCase()==="og:image"?i.previewUrl=t.content:s[o].value.toLowerCase()==="og:url"?i.url=t.content:s[o].value.toLowerCase()==="description"&&(i.description=t.content)}t.nodeName.toLowerCase()==="title"&&(i.title=t.textContent)}),t(i)},n)},getRawImage:function(e,t){$("body").append("<image id='duplicate-image' style='display:none' src='"+e+"'/>"),$("#duplicate-image").load(function(){var e=document.getElementById("duplicate-image"),n=document.createElement("canvas");document.body.appendChild(n),(typeof n.getContext=="undefined"||!n.getContext)&&t(new SBW.Models.User({message:"browser does not support this action, sorry"}));var r="";try{var i=n.getContext("2d"),s=e.width,o=e.height;n.style.display="none",n.width=s,n.height=o,n.style.width=s+"px",n.style.height=o+"px",i.drawImage(e,0,0,s,o),r=n.toDataURL("image/jpeg").split(",")[1];var u=atob(r);document.body.removeChild(n),$("#duplicate-image").remove(),t(u)}catch(a){document.body.removeChild(n),$("#duplicate-image").remove(),t(a)}})}})}(),function(){md5={},md5.util={utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t=[],n=0;for(var r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=String.fromCharCode(i):i>127&&i<2048?(t[n++]=String.fromCharCode(i>>6|192),t[n++]=String.fromCharCode(i&63|128)):(t[n++]=String.fromCharCode(i>>12|224),t[n++]=String.fromCharCode(i>>6&63|128),t[n++]=String.fromCharCode(i&63|128))}return t.join("")},md5:function(e){var t=function(e,t){return e<<t|e>>>32-t},n=function(e,t){var n,r,i,s,o;return i=e&2147483648,s=t&2147483648,n=e&1073741824,r=t&1073741824,o=(e&1073741823)+(t&1073741823),n&r?o^2147483648^i^s:n|r?o&1073741824?o^3221225472^i^s:o^1073741824^i^s:o^i^s},r=function(e,t,n){return e&t|~e&n},i=function(e,t,n){return e&n|t&~n},s=function(e,t,n){return e^t^n},o=function(e,t,n){return t^(e|~n)},u=function(e,i,s,o,u,a,f){return e=n(e,n(n(r(i,s,o),u),f)),n(t(e,a),i)},a=function(e,r,s,o,u,a,f){return e=n(e,n(n(i(r,s,o),u),f)),n(t(e,a),r)},f=function(e,r,i,o,u,a,f){return e=n(e,n(n(s(r,i,o),u),f)),n(t(e,a),r)},l=function(e,r,i,s,u,a,f){return e=n(e,n(n(o(r,i,s),u),f)),n(t(e,a),r)},c=function(e){var t,n=e.length,r=n+8,i=(r-r%64)/64,s=(i+1)*16,o=Array(s-1),u=0,a=0;while(a<n)t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|e.charCodeAt(a)<<u,a++;return t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|128<<u,o[s-2]=n<<3,o[s-1]=n>>>29,o},h=function(e){var t="",n="",r,i;for(i=0;i<=3;i++)r=e>>>i*8&255,n="0"+r.toString(16),t+=n.substr(n.length-2,2);return t},p=Array(),d,v,m,g,y,b,w,E,S,x=7,T=12,N=17,C=22,k=5,L=9,A=14,O=20,M=4,_=11,D=16,P=23,H=6,B=10,j=15,F=21;e=md5.util.utf8_encode(e),p=c(e),b=1732584193,w=4023233417,E=2562383102,S=271733878;for(d=0;d<p.length;d+=16)v=b,m=w,g=E,y=S,b=u(b,w,E,S,p[d+0],x,3614090360),S=u(S,b,w,E,p[d+1],T,3905402710),E=u(E,S,b,w,p[d+2],N,606105819),w=u(w,E,S,b,p[d+3],C,3250441966),b=u(b,w,E,S,p[d+4],x,4118548399),S=u(S,b,w,E,p[d+5],T,1200080426),E=u(E,S,b,w,p[d+6],N,2821735955),w=u(w,E,S,b,p[d+7],C,4249261313),b=u(b,w,E,S,p[d+8],x,1770035416),S=u(S,b,w,E,p[d+9],T,2336552879),E=u(E,S,b,w,p[d+10],N,4294925233),w=u(w,E,S,b,p[d+11],C,2304563134),b=u(b,w,E,S,p[d+12],x,1804603682),S=u(S,b,w,E,p[d+13],T,4254626195),E=u(E,S,b,w,p[d+14],N,2792965006),w=u(w,E,S,b,p[d+15],C,1236535329),b=a(b,w,E,S,p[d+1],k,4129170786),S=a(S,b,w,E,p[d+6],L,3225465664),E=a(E,S,b,w,p[d+11],A,643717713),w=a(w,E,S,b,p[d+0],O,3921069994),b=a(b,w,E,S,p[d+5],k,3593408605),S=a(S,b,w,E,p[d+10],L,38016083),E=a(E,S,b,w,p[d+15],A,3634488961),w=a(w,E,S,b,p[d+4],O,3889429448),b=a(b,w,E,S,p[d+9],k,568446438),S=a(S,b,w,E,p[d+14],L,3275163606),E=a(E,S,b,w,p[d+3],A,4107603335),w=a(w,E,S,b,p[d+8],O,1163531501),b=a(b,w,E,S,p[d+13],k,2850285829),S=a(S,b,w,E,p[d+2],L,4243563512),E=a(E,S,b,w,p[d+7],A,1735328473),w=a(w,E,S,b,p[d+12],O,2368359562),b=f(b,w,E,S,p[d+5],M,4294588738),S=f(S,b,w,E,p[d+8],_,2272392833),E=f(E,S,b,w,p[d+11],D,1839030562),w=f(w,E,S,b,p[d+14],P,4259657740),b=f(b,w,E,S,p[d+1],M,2763975236),S=f(S,b,w,E,p[d+4],_,1272893353),E=f(E,S,b,w,p[d+7],D,4139469664),w=f(w,E,S,b,p[d+10],P,3200236656),b=f(b,w,E,S,p[d+13],M,681279174),S=f(S,b,w,E,p[d+0],_,3936430074),E=f(E,S,b,w,p[d+3],D,3572445317),w=f(w,E,S,b,p[d+6],P,76029189),b=f(b,w,E,S,p[d+9],M,3654602809),S=f(S,b,w,E,p[d+12],_,3873151461),E=f(E,S,b,w,p[d+15],D,530742520),w=f(w,E,S,b,p[d+2],P,3299628645),b=l(b,w,E,S,p[d+0],H,4096336452),S=l(S,b,w,E,p[d+7],B,1126891415),E=l(E,S,b,w,p[d+14],j,2878612391),w=l(w,E,S,b,p[d+5],F,4237533241),b=l(b,w,E,S,p[d+12],H,1700485571),S=l(S,b,w,E,p[d+3],B,2399980690),E=l(E,S,b,w,p[d+10],j,4293915773),w=l(w,E,S,b,p[d+1],F,2240044497),b=l(b,w,E,S,p[d+8],H,1873313359),S=l(S,b,w,E,p[d+15],B,4264355552),E=l(E,S,b,w,p[d+6],j,2734768916),w=l(w,E,S,b,p[d+13],F,1309151649),b=l(b,w,E,S,p[d+4],H,4149444226),S=l(S,b,w,E,p[d+11],B,3174756917),E=l(E,S,b,w,p[d+2],j,718787259),w=l(w,E,S,b,p[d+9],F,3951481745),b=n(b,v),w=n(w,m),E=n(E,g),S=n(S,y);var I=h(b)+h(w)+h(E)+h(S);return I.toLowerCase()}}}();var OAuth;OAuth==null&&(OAuth={}),OAuth.setProperties=function(t,n){if(t!=null&&n!=null)for(var r in n)t[r]=n[r];return t},OAuth.setProperties(OAuth,{percentEncode:function(t){if(t==null)return"";if(t instanceof Array){var n="";for(var r=0;r<t.length;++t)n!=""&&(n+="&"),n+=OAuth.percentEncode(t[r]);return n}return t=encodeURIComponent(t),t=t.replace(/\!/g,"%21"),t=t.replace(/\*/g,"%2A"),t=t.replace(/\'/g,"%27"),t=t.replace(/\(/g,"%28"),t=t.replace(/\)/g,"%29"),t},decodePercent:function(t){return t!=null&&(t=t.replace(/\+/g," ")),decodeURIComponent(t)},getParameterList:function(t){if(t==null)return[];if(typeof t!="object")return OAuth.decodeForm(t+"");if(t instanceof Array)return t;var n=[];for(var r in t)n.push([r,t[r]]);return n},getParameterMap:function(t){if(t==null)return{};if(typeof t!="object")return OAuth.getParameterMap(OAuth.decodeForm(t+""));if(t instanceof Array){var n={};for(var r=0;r<t.length;++r){var i=t[r][0];n[i]===undefined&&(n[i]=t[r][1])}return n}return t},getParameter:function(t,n){if(t instanceof Array){for(var r=0;r<t.length;++r)if(t[r][0]==n)return t[r][1];return null}return OAuth.getParameterMap(t)[n]},formEncode:function(t){var n="",r=OAuth.getParameterList(t);for(var i=0;i<r.length;++i){var s=r[i][1];s==null&&(s=""),n!=""&&(n+="&"),n+=OAuth.percentEncode(r[i][0])+"="+OAuth.percentEncode(s)}return n},decodeForm:function(t){var n=[],r=t.split("&");for(var i=0;i<r.length;++i){var s=r[i];if(s=="")continue;var o=s.indexOf("="),u,a;o<0?(u=OAuth.decodePercent(s),a=null):(u=OAuth.decodePercent(s.substring(0,o)),a=OAuth.decodePercent(s.substring(o+1))),n.push([u,a])}return n},setParameter:function(t,n,r){var i=t.parameters;if(i instanceof Array){for(var s=0;s<i.length;++s)i[s][0]==n&&(r===undefined?i.splice(s,1):(i[s][1]=r,r=undefined));r!==undefined&&i.push([n,r])}else i=OAuth.getParameterMap(i),i[n]=r,t.parameters=i},setParameters:function(t,n){var r=OAuth.getParameterList(n);for(var i=0;i<r.length;++i)OAuth.setParameter(t,r[i][0],r[i][1])},completeRequest:function(t,n){t.method==null&&(t.method="GET");var r=OAuth.getParameterMap(t.parameters);r.oauth_consumer_key==null&&OAuth.setParameter(t,"oauth_consumer_key",n.consumerKey||""),r.oauth_token==null&&n.access_token!=null&&OAuth.setParameter(t,"oauth_token",n.access_token),r.oauth_version==null&&OAuth.setParameter(t,"oauth_version","1.0"),r.oauth_timestamp==null&&OAuth.setParameter(t,"oauth_timestamp",OAuth.timestamp()),r.oauth_nonce==null&&OAuth.setParameter(t,"oauth_nonce",OAuth.nonce(6)),r.oauth_callback==null&&OAuth.setParameter(t,"oauth_callback","oob"),OAuth.SignatureMethod.sign(t,n)},setTimestampAndNonce:function(t){OAuth.setParameter(t,"oauth_timestamp",OAuth.timestamp()),OAuth.setParameter(t,"oauth_nonce",OAuth.nonce(6))},addToURL:function(t,n){newURL=t;if(n!=null){var r=OAuth.formEncode(n);if(r.length>0){var i=t.indexOf("?");i<0?newURL+="?":newURL+="&",newURL+=r}}return newURL},getAuthorizationHeader:function(t,n){var r='OAuth realm="'+OAuth.percentEncode(t)+'"',i=OAuth.getParameterList(n);for(var s=0;s<i.length;++s){var o=i[s],u=o[0];u.indexOf("oauth_")==0&&(r+=","+OAuth.percentEncode(u)+'="'+OAuth.percentEncode(o[1])+'"')}return r},correctTimestampFromSrc:function(t){t=t||"oauth_timestamp";var n=document.getElementsByTagName("script");if(n==null||!n.length)return;var r=n[n.length-1].src;if(!r)return;var i=r.indexOf("?");if(i<0)return;parameters=OAuth.getParameterMap(OAuth.decodeForm(r.substring(i+1)));var s=parameters[t];if(s==null)return;OAuth.correctTimestamp(s)},correctTimestamp:function(t){OAuth.timeCorrectionMsec=t*1e3-(new Date).getTime()},timeCorrectionMsec:0,timestamp:function(){var t=(new Date).getTime()+OAuth.timeCorrectionMsec;return Math.floor(t/1e3)},nonce:function(t){var n=OAuth.nonce.CHARS,r="";for(var i=0;i<t;++i){var s=Math.floor(Math.random()*n.length);r+=n.substring(s,s+1)}return r}}),OAuth.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",OAuth.declareClass=function(t,n,r){var i=t[n];t[n]=r;if(r!=null&&i!=null)for(var s in i)s!="prototype"&&(r[s]=i[s]);return r},OAuth.declareClass(OAuth,"SignatureMethod",function(){}),OAuth.setProperties(OAuth.SignatureMethod.prototype,{sign:function(t){var n=OAuth.SignatureMethod.getBaseString(t),r=this.getSignature(n);return OAuth.setParameter(t,"oauth_signature",r),r},initialize:function(t,n){var r;n.accessorSecret!=null&&t.length>9&&t.substring(t.length-9)=="-Accessor"?r=n.accessorSecret:r=n.consumerSecret,this.key=OAuth.percentEncode(r)+"&"+OAuth.percentEncode(n.tokenSecret)}}),OAuth.setProperties(OAuth.SignatureMethod,{sign:function(t,n){var r=OAuth.getParameterMap(t.parameters).oauth_signature_method;if(r==null||r=="")r="HMAC-SHA1",OAuth.setParameter(t,"oauth_signature_method",r);OAuth.SignatureMethod.newMethod(r,n).sign(t)},newMethod:function(t,n){var r=OAuth.SignatureMethod.REGISTERED[t];if(r!=null){var i=new r;return i.initialize(t,n),i}var s=new Error("signature_method_rejected"),o="";for(var u in OAuth.SignatureMethod.REGISTERED)o!=""&&(o+="&"),o+=OAuth.percentEncode(u);throw s.oauth_acceptable_signature_methods=o,s},REGISTERED:{},registerMethodClass:function(t,n){for(var r=0;r<t.length;++r)OAuth.SignatureMethod.REGISTERED[t[r]]=n},makeSubclass:function(t){var n=OAuth.SignatureMethod,r=function(){n.call(this)};return r.prototype=new n,r.prototype.getSignature=t,r.prototype.constructor=r,r},getBaseString:function(t){var n=t.action,r=n.indexOf("?"),i;if(r<0)i=t.parameters;else{i=OAuth.decodeForm(n.substring(r+1));var s=OAuth.getParameterList(t.parameters);for(var o=0;o<s.length;++o)i.push(s[o])}return OAuth.percentEncode(t.method.toUpperCase())+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeUrl(n))+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeParameters(i))},normalizeUrl:function(t){var n=OAuth.SignatureMethod.parseUri(t),r=n.protocol.toLowerCase(),i=n.authority.toLowerCase(),s=r=="http"&&n.port==80||r=="https"&&n.port==443;if(s){var o=i.lastIndexOf(":");o>=0&&(i=i.substring(0,o))}var u=n.path;return u||(u="/"),r+"://"+i+u},parseUri:function(t){var n={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=n.parser.strict.exec(t),i={},s=14;while(s--)i[n.key[s]]=r[s]||"";return i},normalizeParameters:function(t){if(t==null)return"";var n=OAuth.getParameterList(t),r=[];for(var i=0;i<n.length;++i){var s=n[i];s[0]!="oauth_signature"&&r.push([OAuth.percentEncode(s[0])+" "+OAuth.percentEncode(s[1]),s])}r.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0});var o=[];for(var u=0;u<r.length;++u)o.push(r[u][1]);return OAuth.formEncode(o)}}),OAuth.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],OAuth.SignatureMethod.makeSubclass(function(t){return this.key})),OAuth.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],OAuth.SignatureMethod.makeSubclass(function(t){b64pad="=";var n=b64_hmac_sha1(this.key,t);return n}));try{OAuth.correctTimestampFromSrc()}catch(e){}var hexcase=0,b64pad="",chrsz=8,sha256Init=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],sha256Roots=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],sha256Tail=[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];SBW.Models.Asset=SBW.Object.extend({type:"asset",id:"",title:"",createdTime:"",serviceName:null,rawData:[],status:"private",imgSizes:{t:"",s:"",m:"",l:""},metadata:{caption:null,type:null,dateTaken:null,dateUpdated:null,dateUploaded:null,comments:null,size:null,assetId:null,assetCollectionId:null,height:null,width:null,commentCount:null,category:null,exifMake:null,exifModel:null,iptcKeywords:null,orientation:null,tags:null,downloadUrl:null,originalFormat:null,fileName:null,version:null,description:null,thumbnail:null,previewUrl:null,author:null,authorAvatar:null,likeCount:0,likes:null},init:function(e){for(var t in e)this.constructor[t]=e[t]},getID:function(){return this.type+Math.floor(Math.random()*1e3)}}),SBW.Models.AssetCollection=SBW.Object.extend({id:"",title:"",createdTime:"",rawData:[],status:"private",serviceName:null,assets:[],metadata:{dateUpdated:null,dateUploaded:null,numAssets:null,assetCollectionId:null,type:null,tags:null,fileName:null,description:null,thumbnail:null,previewUrl:null,author:null,authorAvatar:null,commentCount:null,comments:null,likeCount:0,likes:null},init:function(e){for(var t in e)this.constructor[t]=e[t]},getID:function(){return"collection"+Math.floor(Math.random()*1e3)}}),SBW.Models.AudioAsset=SBW.Models.Asset.extend({type:"audio",url:"",duration:0}),SBW.Models.Comment=SBW.Object.extend({text:"",id:"",createdTime:null,fromUser:"",likeCount:null,userImage:"",rawData:null,serviceName:"",fromUserId:""}),SBW.Models.Error=SBW.Object.extend({message:"",code:null,serviceName:"",rawData:null}),SBW.Models.ImageAsset=SBW.Models.Asset.extend({type:"image",src:""}),SBW.Models.Like=SBW.Object.extend({user:[],rawData:null}),SBW.Models.UploadFileMetaData=SBW.Object.extend({title:"",description:"",location:"",file:null}),SBW.Models.UploadStatus=SBW.Object.extend({serviceName:"",id:"",postId:"",status:"",rawData:null}),SBW.Models.User=SBW.Object.extend({name:null,screenName:null,id:null,userImage:"",rawData:null}),SBW.Models.VideoAsset=SBW.Models.Asset.extend({type:"video",url:"",duration:0}),function(){"use strict";SBW.Controllers.ServiceFactory=SBW.Object.extend({_services:{},registerService:function(e,t){var n=new SBW.Utils;n.isType(t,Function)&&(this._services[e]=new t)},getService:function(e){return this._services[e]}})}(),function(){"use strict";SBW.init=function(t,n){SBW.Singletons.serviceFactory=new SBW.Controllers.ServiceFactory,SBW.logger=new SBW.Logger,SBW.Singletons.utils=new SBW.Utils,SBW.api=new SBW.Controllers.Services.ServiceController,SBW.Singletons.utils.isType(t,String)?SBW.Singletons.utils.ajax({url:t,dataType:"json"},function(t){e(t,n)},function(e){n(e)}):SBW.Singletons.utils.isType(t,Object)&&e(t,n)};var e=function(e,t){var n,r,i;SBW.Singletons.config=e,n=SBW.Singletons.config.services,SBW.logger.on=SBW.Singletons.config.debug==="true"?!0:!1;for(r in n)n.hasOwnProperty(r)&&(i=r.toLowerCase(),SBW.Singletons.serviceFactory.registerService(i,SBW.Controllers.Services[r]),SBW.Singletons.serviceFactory.getService(i).init());SBW.Singletons.utils.isType(t,Function)&&t()}}(),function(){"use strict";SBW.Controllers.Services.ServiceController=SBW.Object.extend({name:null,user:null,icon:null,title:null,accessObject:[],isUserLoggedIn:!1,isRemoteService:!0,fileStatus:{},_forEach:function(e,t){this.utils||(this.utils=new SBW.Utils),this.utils.forEach(e,t)},init:function(){},reset:function(){},setup:function(){},checkUserLoggedIn:function(e,t){SBW.Singletons.serviceFactory.getService(e).checkUserLoggedIn(t)},populateUserInformation:function(e){this.user=e},startActionHandler:function(e){},getAccessToken:function(e,t){},failureLoginHandler:function(e,t){},publishMessage:function(e,t,n,r){e instanceof Array?e.forEach(function(e,i,s){SBW.Singletons.serviceFactory.getService(e).publishMessage(t,n,r)}):SBW.Singletons.serviceFactory.getService(e).publishMessage(t,n,r)},postShare:function(e,t,n,r){e instanceof Array?e.forEach(function(e,i,s){SBW.Singletons.serviceFactory.getService(e).postShare(t,n,r)}):SBW.Singletons.serviceFactory.getService(e).postShare(t,n,r)},successLoginHandler:function(e,t){this.set("isUserLoggedIn",!0),this.set("isUserLoggingIn",!1),e&&e.set("name",unescape(e.get("name"))),this.set("user",e)},publishLink:function(e,t,n,r,i,s,o,u,a,f,l){e instanceof Array?e.forEach(function(e,c,h){SBW.Singletons.serviceFactory.getService(e).publishLink(t,n,r,i,s,o,u,a,f,l)}):SBW.Singletons.serviceFactory.getService(e).publishLink(t,n,r,i,s,o,u,a,f,l)},publishEvent:function(e,t,n,r,i,s){e instanceof Array?e.forEach(function(e,o,u){SBW.Singletons.serviceFactory.getService(e).publishEvent(t,n,r,i,s)}):SBW.Singletons.serviceFactory.getService(e).publishEvent(t,n,r,i,s)},like:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).like(t,n,r)},unlike:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).unlike(t,n,r)},postComment:function(e,t,n,r,i){e instanceof Array?e.forEach(function(e,s,o){SBW.Singletons.serviceFactory.getService(e).postComment(t,n,r,i)}):SBW.Singletons.serviceFactory.getService(e).postComment(t,n,r,i)},getPosts:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getPosts(t,n,r)},getLikes:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getLikes(t,n,r)},deleteComment:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).deleteComment(t,n,r)},getComments:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getComments(t,n,r)},getAlbums:function(e,t,n){SBW.Singletons.serviceFactory.getService(e).getAlbums(t,n)},getPhotos:function(e,t,n){SBW.Singletons.serviceFactory.getService(e).getPhotos(t,n)},getPhotosFromAlbum:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getPhotosFromAlbum(t,n,r)},getCommentsForUrl:function(e,t,n,r){e instanceof Array?e.forEach(function(e,i,s){SBW.Singletons.serviceFactory.getService(e).getCommentsForUrl(t,n,r)}):SBW.Singletons.serviceFactory.getService(e).getCommentsForUrl(t,n,r)},follow:function(e,t,n,r){var i=SBW.Singletons.serviceFactory;i.getService(e).follow(t,n,r)},getFollowCount:function(e,t,n,r){var i=SBW.Singletons.serviceFactory;i.getService(e).getFollowCount(t,n,r)},getEvents:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getEvents(t,n,r)},getSocialGroups:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getSocialGroups(t,n,r)},getShareCount:function(e,t,n,r){e instanceof Array?e.forEach(function(e,i,s){SBW.Singletons.serviceFactory.getService(e).getShareCount(t,n,r)}):SBW.Singletons.serviceFactory.getService(e).getShareCount(t,n,r)},getFriends:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getFriends(t,n,r)},getProfilePic:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getProfilePic(t,n,r)},publishNotes:function(e,t,n,r,i){e instanceof Array?e.forEach(function(e,s,o){SBW.Singletons.serviceFactory.getService(e).publishNotes(t,n,r,i)}):SBW.Singletons.serviceFactory.getService(e).publishNotes(t,n,r,i)},getNotes:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getNotes(t,n,r)},getPopupWindowParams:function(e){var t=e.height==undefined?"250":e.height,n=e.width==undefined?"500":e.width,r=($(window).width()-n)/2,i=($(window).height()-t)/2,s="width="+n;return s+=", height="+t,s+=", top="+i+", left="+r,s+=", location=no",s+=", menubar=no",s+=", resizable=no",s+=", scrollbars=yes",s+=", status=no",s+=", toolbar=no",s},getCookie:function(e){var t=document.cookie.split(";"),n=null;for(var r=0;r<t.length;r++){var i=t[r].split("=");if(i[1]&&$.trim(i[0])==e&&$.trim(i[1]).length>0){n=i[1];break}}return n},getProfile:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getProfile(t,n,r)},createCookie:function(e,t,n){var r,i=window.location.hostname.substr(window.location.hostname.indexOf("."));if(n){var s=new Date;s.setTime(s.getTime()+n*24*60*60*1e3),r="; expires="+s.toGMTString()}else r="";document.cookie=e+"="+t+r+"; path=/"+"; domain="+i},eraseCookie:function(e){this.createCookie(e,"",-1)},uploadVideo:function(e,t,n,r){e instanceof Array?e.forEach(function(e,i,s){SBW.Singletons.serviceFactory.getService(e).uploadVideo(t,n,r)}):SBW.Singletons.serviceFactory.getService(e).uploadVideo(t,n,r)},uploadPhoto:function(e,t,n,r){e instanceof Array?e.forEach(function(e,i,s){SBW.Singletons.serviceFactory.getService(e).uploadPhoto(t,n,r)}):SBW.Singletons.serviceFactory.getService(e).uploadPhoto(t,n,r)},getPostByID:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getPostByID(t,n,r)},getCommentByID:function(e,t,n,r){SBW.Singletons.serviceFactory.getService(e).getCommentByID(t,n,r)},fileUpload:function(e,t,n,r,i){var s=0,o=0,u=n.processData||!1,a,f=t.length,l=[],c=this;c.fileStatus[e]=c.fileStatus[e]||[];for(s=0;s<f;s+=1){a=s;var h=new FormData;for(var p in t[s])t[s].hasOwnProperty(p)&&h.append(p,t[s][p]);var d=function(t){return function(n){o++,l[t]=n,o===f&&c.postUpload(e,l,r,i)}}(a),v=function(t){return function(n){o++,l[t]=n,o===f&&c.postUpload(e,l,r,i)}}(a);SBW.Singletons.utils.ajax({url:n.url,type:n.type,data:h,dataType:n.dataType,processData:u,contentType:!1},d,v)}},getAsset:function(e,t,n){var r=SBW.Singletons.serviceFactory.getService(e)&&SBW.Singletons.serviceFactory.getService(e).content||[],i;return r.forEach(function(e){e.metadata.assetCollectionId===t&&e.assets.forEach(function(e){e.metadata.assetId===n&&(i=e)})}),i},logout:function(e,t,n){SBW.Singletons.serviceFactory.getService(e).logout(t,n)},postUpload:function(e,t,n,r){e instanceof Array?e.forEach(function(e,i,s){SBW.Singletons.serviceFactory.getService(e).postUpload(t,n,r)}):SBW.Singletons.serviceFactory.getService(e).postUpload(t,n,r)},uploadRawImage:function(e,t,n,r){e instanceof Array?e.forEach(function(e,i,s){SBW.Singletons.serviceFactory.getService(e).uploadRawImage(t,n,r)}):SBW.Singletons.serviceFactory.getService(e).uploadRawImage(t,n,r)}})}(),SBW.Controllers.Services.Facebook=SBW.Controllers.Services.ServiceController.extend({name:"facebook",content:[],icon:"facebook",title:"Facebook",facebookInit:!1,apiUrl:"https://graph.facebook.com",allowedExtensions:{photo:/GIF|JPG|PNG|PSD|TIFF|JP2|IFF|WBMP|XBM/i,video:/3g2|3gp|3gpp|asf|avi|dat|divx|dv|f4v|flv|m2ts|m4v|mkv|mod|mov|mp4|mpe|mpeg|mpeg4|mpg|mts|nsv|ogm|ogv|qt|tod|ts|vob|wmv/i},init:function(){this.accessObject={appId:SBW.Singletons.config.services.Facebook.appID,token:null},this.setup()},setup:function(){var e=this;$(document).ready(function(){var t=document.createElement("script"),n=!1;if(document.getElementById("fb-root")===null){var r=document.createElement("script"),i=document.createAttribute("id"),s=document.getElementsByTagName("body")[0]||document.documentElement;i.value="fb-root",r.setAttributeNode(i),s.insertBefore(r,s.lastChild)}t.src="//connect.facebook.net/en_US/all.js",t.onload=t.onreadystatechange=function(){!n&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(n=!0,FB.init({appId:e.accessObject.appId,xfbml:!0,status:!0,cookie:!0}),navigator.userAgent.indexOf("MSIE")!==-1&&(FB.UIServer.setLoadedNode=function(e,t){FB.UIServer._loadedNodes[e.id]=t}),t.onload=t.onreadystatechange=null,e.facebookInit=!0)};var o=document.getElementsByTagName("head")[0]||document.documentElement;o.insertBefore(t,o.firstChild)})},startActionHandler:function(e){var t=this;t.facebookInit?FB.getLoginStatus(function(n){t.user=t.user||new SBW.
Models.User;if(n.status==="connected")t.getAccessToken.call(t,n,function(n){t.user.name=n.name,t.user.id=n.id,t.getProfilePic(null,function(e){t.user.userImage=e},function(e){SBW.logger.debug("Could not fetch image url")}),e()});else{window._facebookopen=window.open,window.open=function(e,n,r){return t.authWindowReference=window._facebookopen(e,n,r),t.authWindowReference},FB.login(function(n){n.authResponse!==null&&!$.isEmptyObject(n.authResponse)?t.getAccessToken.call(t,n,function(n){t.user.name=n.name,t.user.id=n.id,t.getProfilePic(null,function(e){t.user.userImage=e},function(e){SBW.logger.debug("Could not fetch image url")}),e()}):(t.isUserLoggingIn=!1,t.authWindowReference.close())},{scope:"user_photos,user_videos,publish_stream,read_stream,publish_actions,user_events,create_event,user_groups,user_notes"}),window.open=window._facebookopen,window._facebookopen=null;var r=setInterval(function(){t.authWindowReference.closed&&(t.isUserLoggingIn=!1,clearInterval(r))},1e3)}}):setTimeout(function(){t.startActionHandler()},1e3)},checkUserLoggedIn:function(e){var t=this;t.facebookInit?FB.api("/me?access_token="+t.accessObject.token,function(t){t.name!==undefined||t.error===null?e(!0):e(!1)}):setTimeout(function(){t.checkUserLoggedIn(e)},1e3)},getAccessToken:function(e,t){var n=this;e.status==="connected"?(n.accessObject.uid=e.authResponse.userID,n.accessObject.token=e.authResponse.accessToken,n.accessObject.tokenSecret=e.authResponse.signedRequest,FB.api("/me?access_token="+n.accessObject.token,function(e){e.name?(t(e),n.authWindowReference&&!n.authWindowReference.closed&&n.authWindowReference.close()):n.failureLoginHandler.call(n,t)})):n.failureLoginHandler.call(n,t)},publishMessage:function(e,t,n){var r=this,i=function(e,t,n){FB.api("/me/feed?access_token="+r.accessObject.token,"post",{message:e},function(e){if(e.id!==undefined||e.error===null)t&&t({id:e.id,serviceName:"facebook"},e);else if(n){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}})},s=function(e,t,n){return function(){i(e,t,n)}}(e,t,n);r.startActionHandler(s)},postShare:function(e,t,n){var r=this,i=function(e,t,n){FB.api("/me/feed?access_token="+r.accessObject.token,"post",{message:e.message||null,picture:e.picture||null,link:e.link||null,name:e.name||null,caption:e.caption||null,description:e.description||null,actions:e.actions.name&&e.actions.link?{name:e.actions.name,link:e.actions.link}:null},function(e){if(e.id!==undefined||e.error===null)t&&t({id:e.id,serviceName:"facebook"},e);else if(n){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},subscribe:function(e,t,n){var r=this,i=function(e,t,n){FB.api("/me/og.follows?access_token="+r.accessObject.token,"post",{profile:e},function(e){if(e.name!==undefined||e.error===null)t&&t(e);else if(n){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},share:function(e,t,n){var r=this,i=function(e,t,n){FB.api("/me/feed?access_token="+r.accessObject.token,"post",{link:e},function(e){if(e.name!==undefined||e.error===null)t&&t(e);else if(n){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}})},s=function(e,t,n){return function(){i(e,t,n)}}(e,t,n);r.startActionHandler(s)},publishLink:function(e,t,n,r,i,s,o,u,a,f){var l=this,c={type:e,name:t,caption:n,message:r,link:i,description:s,picture:o,icon:u},h=function(e,t,n){FB.api("/me/feed?access_token="+l.accessObject.token,"post",{type:e.type,name:e.name,message:e.message,caption:e.caption,link:e.link,description:e.description,picture:e.picture,icon:e.icon},function(e){if(e.name!==undefined||e.error===null)t&&t(e);else if(n){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}})},p=function(e,t,n){return function(r){r?h(e,t,n):l.startActionHandler(function(){h(e,t,n)})}}(c,a,f);l.checkUserLoggedIn(p)},publishEvent:function(e,t,n,r,i){var s=this,o=function(e,t,n,r,i){FB.api("/me/events?access_token="+s.accessObject.token,"post",{name:e,start_time:t,end_time:n},function(e){if(!e.id||!e.error)r&&r(e);else if(i){var t=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});i(t)}})},u=function(e,t,n,r,i){return function(u){u?o(e,t,n,r,i):s.startActionHandler(function(){o(e,t,n,r,i)})}}(e,t,n,r,i);s.checkUserLoggeIdn(u)},like:function(e,t,n){var r=this,i=function(e,t,n){FB.api("/"+e+"/likes?access_token="+r.accessObject.token,"post",function(e){if(e&&!e.error)t&&t(e);else if(n){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}})},s=function(e,t,n){return function(){i(e,t,n)}}(e,t,n);r.startActionHandler(s)},unlike:function(e,t,n){var r=this,i=function(e,t,n){FB.api("/"+e+"/likes?access_token="+r.accessObject.token,"delete",function(e){if(e&&!e.error)t&&t(e);else if(n){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}})},s=function(e,t,n){return function(){i(e,t,n)}}(e,t,n);r.startActionHandler(s)},postComment:function(e,t,n,r){var i=this,s=function(e,t,n,r){FB.api("/"+e.assetId+"/comments?access_token="+i.accessObject.token,"post",{message:t},function(e){if(e.error){if(r){var t=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});r(t)}}else n&&n(e)})},o=function(e,t,n,r){return function(o){o?s(e,t,n,r):i.startActionHandler(function(){s(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(o)},_getData:function(e,t){var n=this,r=e.url,i;r||(i=e.id?e.id:"me",e.type==="posts"?r="/"+i+"/feed?access_token="+n.accessObject.token:e.type==="likes"?r="/"+e.id+"/likes?access_token="+n.accessObject.token:e.type==="comments"?r="/"+e.id+"/comments?access_token="+n.accessObject.token:e.type==="events"?r="/"+i+"/events?access_token="+n.accessObject.token:e.type==="friends"?r="/"+i+"/friends?access_token="+n.accessObject.token:e.type==="notes"?r="/"+i+"/notes?access_token="+n.accessObject.token:e.type==="groups"?r="/"+i+"/groups?access_token="+n.accessObject.token:e.type==="user"?r="/"+i+"?access_token="+n.accessObject.token:e.type==="post"&&(r="/"+e.id+"?access_token="+n.accessObject.token)),FB.api(r,"get",function(e){t(e)})},_getAllData:function(e,t,n){var r=this,i=[],s=function(e,t){return function(n){if(n&&!n.error){if(!n.data){e(n);return}for(var o=0,u=n.data.length;o<u;o++)n.data[o].story||i.push(n.data[o]);n.paging&&n.paging.next?r._getData({url:n.paging.next},s):e(i)}else{var a=new SBW.Models.Error({message:n.error.message,code:n.error.code,serviceName:"facebook",rawData:n});t(a)}}}(t,n);r._getData(e,s)},getPosts:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"posts",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"posts",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getPostByID:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"post",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"post",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getLikes:function(e,t,n){var r=this,i=function(e){var n=[];for(var r=0;r<e.length;r++){var i=new SBW.Models.User({name:e[r].name,id:e[r].id});n[r]=new SBW.Models.Like({user:i,rawData:e[r]})}var s={serviceName:"facebook",rawData:e,likes:n,likeCount:n.length};t(s)},s=function(t,n){return function(t){t?r._getAllData({type:"likes",id:e},i,n):r.startActionHandler(function(){r._getAllData({type:"likes",id:e},i,n)})}}(t,n);r.checkUserLoggedIn(s)},getShareCount:function(e,t,n){var r=this,i=function(e,t,n){FB.api("fql",{q:"SELECT url, normalized_url, share_count, like_count, comment_count, total_count, commentsbox_count, comments_fbid, click_count FROM link_stat WHERE url = '"+e+"'"},function(e){if(e&&!e.error)t&&t({count:e.data[0].share_count||0},e);else if(n){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}})};r.facebookInit?i(e,t,n):setTimeout(function(){r.getShareCount(e,t,n)},1e3)},_populateAlbumThumbnail:function(e,t){var n=this,r=function(e,t){var r=0;n.content.forEach(function(t,i,s){FB.api("/"+t.metadata.coverid+"?access_token="+n.accessObject.token,"get",function(i){r++,i&&!i.error&&(t.metadata.thumbnail=i.picture||""),r===s.length&&e(n.content)})})},i=function(e,t){return function(i){i?r(e,t):n.startActionHandler(function(){r(e,t)})}}(e,t);n.checkUserLoggedIn(i)},getAlbums:function(e,t){var n=this,r=function(e,t){n.content.length>0?e(n.content):FB.api("/me/albums?access_token="+n.accessObject.token,"get",function(r){if(r&&!r.error){var i=null,s=null;r.data.forEach(function(e){i=new SBW.Models.AssetCollection({title:e.name,createdTime:(new Date).getTime(),status:null,serviceName:"facebook",metadata:{dateUpdated:(new Date(e.updated_time)).toDateString(),dateUploaded:(new Date(e.created_time)).toDateString(),numAssets:e.count,comments:[],coverid:e.cover_photo,assetCollectionId:e.id,commentCount:e.comments&&e.comments.data.length||0,fileName:null,description:e.description||"",author:e.from.name}}),e.comments&&e.comments.data.forEach(function(e){s=new SBW.Models.Comment({text:e.message,createdTime:e.created_time,fromUser:e.from.name,likeCount:e.like_count,userImage:"",serviceName:"facebook",rawData:e}),i.metadata.comments.push(s)}),i.id=i.getID(),n.content.push(i),n.collectionSetRawData=r}),n._populateAlbumThumbnail(function(t){e(t)},t)}else if(t){var o=new SBW.Models.Error({message:r.error.message,code:r.error.code,serviceName:"facebook",rawData:r});t(o)}})},i=function(e,t){return function(i){i?r(e,t):n.startActionHandler(function(){r(e,t)})}}(e,t);n.checkUserLoggedIn(i)},getPhotosFromAlbum:function(e,t,n){var r=this,i=function(e,t,n){FB.api("/"+e+"/photos?access_token="+r.accessObject.token,"get",function(i){if(i&&!i.error){var s=[];i.data.forEach(function(e){var t=new SBW.Models.ImageAsset({src:e.source,title:e.name,createdTime:e.created_time,rawData:e,serviceName:"facebook",metadata:{dateUpdated:(new Date(e.updated_time)).toDateString(),dateUploaded:(new Date(e.created_time)).toDateString(),size:null,assetId:e.id,assetCollectionId:e.albumId,height:e.height,comments:[],width:e.width,commentCount:e.comments&&e.comments.data.length,originalFormat:null,version:null,description:e.name,author:e.from.name}});e.comments&&e.comments.data.forEach(function(e){comment=new SBW.Models.Comment({text:e.message,createdTime:e.created_time,fromUser:e.from.name||"unknownn",likeCount:e.like_count,userImage:null,serviceName:"facebook",rawData:e}),t.metadata.comments.push(comment)}),t.id=t.getID(),s.push(t)}),r._populateAssets(e,s),t(s)}else if(n){var o=new SBW.Models.Error({message:i.error.message,code:i.error.code,serviceName:"facebook",rawData:i});n(o)}})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},_populateAssets:function(e,t){var n=this;n.content.forEach(function(n){if(n.metadata.assetCollectionId===e)return n.assets=t,!1})},deleteComment:function(e,t,n){var r=this,i=function(e,t,n){FB.api("/"+e,"delete",function(e){if(e.error){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}else t(e)})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getComments:function(e,t,n){var r=this,i=function(t,n){return function(i){var s=function(e){var n=[];for(var r=0;r<e.length;r++)n[r]=new SBW.Models.Comment({createdTime:e[r].created_time,fromUser:e[r].from.name,fromUserId:e[r].from.id,likeCount:e[r].like_count,text:e[r].message,rawData:e[r],serviceName:"facebook"});t(n)};i?r._getAllData({type:"comments",id:e.assetId},s,n):r.startActionHandler(function(){r._getAllData({type:"comments",id:e.assetId},s,n)})}}(t,n);r.checkUserLoggedIn(i)},getEvents:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"events",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"events",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getSocialGroups:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"groups",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"groups",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getFriends:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"friends",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"friends",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getProfilePic:function(e,t,n){e=e?e:"me";var r=this,i=function(e,t,n){FB.api("/"+e+"/picture","get",function(e){if(e&&!e.error)t&&t(e.data.url);else if(n){var r=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(r)}})};i(e,t,n)},publishNotes:function(e,t,n,r){var i=this,s=function(e,t,n,r){FB.api("/me/notes?access_token="+i.accessObject.token,"post",{message:t,subject:e},function(e){if(e&&!e.error)n&&n(e);else if(r){var t=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});r(t)}})},o=function(e,t,n,r){return function(o){o?s(e,t,n,r):i.startActionHandler(function(){s(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(o)},getNotes:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"notes",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"notes",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getProfile:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"user",method:"get",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"user",method:"get",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},uploadPhoto:function(e,t,n){var r=this.apiUrl+"/me/photos";this._uploadMedia(e,t,n,r)},uploadVideo:function(e,t,n){var r="https://graph-video.facebook.com/me/videos";this._uploadMedia(e,t,n,r)},_uploadMedia:function(e,t,n,r){var i=this,s=function(e,t,n,r){var s=r+"?access_token="+i.accessObject.token,o={url:s,type:"POST",dataType:"json",contentType:!1};SBW.api.fileUpload("facebook",e,o,t,n)},o=function(e,t,n,r){return function(o){o?s(e,t,n,r):i.startActionHandler(function(){s(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(o)},postUpload:function(e,t,n){var r=[],i=t;e.forEach(function(e){e&&!e.error?r.push(new SBW.Models.UploadStatus({id:e.id,postId:e.post_id,serviceName:"facebook",status:"success",rawData:e})):(i=n,r.push(new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e})))}),i(r)},publishPhoto:function(e,t,n,r){var i=this,s=function(e,t,n,r){FB.api("/me/photos?access_token="+i.accessObject.token,"post",{url:t,message:e},function(e){if(e&&!e.error)n&&n(e);else if(r){var t=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});r(t)}})},o=function(e,t,n,r){return function(o){o?s(e,t,n,r):i.startActionHandler(function(){s(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(o)},logout:function(e,t){var n=this;n.accessObject.token=null,n.content=[],FB.logout(function(n){if(n.error){var r=new SBW.Models.Error({message:n.error.message,code:n.error.code,serviceName:"facebook",rawData:n});t(r)}else e(n)})},uploadRawImage:function(e,t,n){var r=this,i=JSON.parse(JSON.stringify(e));i.forEach(function(e){var i=SBW.Singletons.config.proxyURL+"?url="+e.file,s=function(i){if(i.length){var s=i.length,o=new ArrayBuffer(s),u=new Uint8Array(o);for(var a=0;a<s;a++)u[a]=i.charCodeAt(a);e.file=new Blob([o],{type:"image/jpeg"}),r.uploadPhoto([e],t,n)}else n(i)};SBW.Singletons.utils.getRawImage(i,s)})},getCommentsForUrl:function(e,t,n){var r=this,i=function(e){var n=[],i=0;e.data.forEach(function(e,s,o){r.getProfilePic(e.from.id,function(r){var u=new SBW.Models.Comment({createdTime:e.created_time,fromUser:e.from.name,likeCount:e.like_count,text:e.message,userImage:r,rawData:e,serviceName:"facebook"});n[s]=u,i++,i===o.length&&t(n)},function(r){var u=new SBW.Models.Comment({createdTime:e.created_time,fromUser:e.from.name,likeCount:e.like_count,text:e.message,rawData:e,serviceName:"facebook"});n[s]=u,i++,i===o.length&&t(n)})})},s=function(e){var t=new SBW.Models.Error({message:e.error.message,code:e.error.code,serviceName:"facebook",rawData:e});n(t)};SBW.Singletons.utils.ajax({url:r.apiUrl+"/comments/?id="+e.url+"&limit="+(e.limit||10)+"&offset="+(e.offset||0),type:"GET",data:{},dataType:"json"},i,s)}}),SBW.Controllers.Services.Flickr=SBW.Controllers.Services.ServiceController.extend({name:"flickr",icon:"flickr",title:"Flickr",content:[],init:function(){this.callbackUrl=SBW.Singletons.utils.callbackURLForService("Flickr"),this.proxyUrl=SBW.Singletons.config.proxyURL,this.requestTokenUrl="http://www.flickr.com/services/oauth/request_token",this.authorizationUrl="http://www.flickr.com/services/oauth/authorize",this.accessTokenUrl="http://www.flickr.com/services/oauth/access_token",this.flickrApiUrl="http://api.flickr.com/services/rest",this.flickrUploadApiUrl="http://api.flickr.com/services/upload/",this.accessObject={consumerKey:SBW.Singletons.config.services.Flickr.apiKey,consumerSecret:SBW.Singletons.config.services.Flickr.secret,access_token:null,id:null,permissionLevel:"write"}},startActionHandler:function(e){var t=this;t.eraseCookie("flickrToken");var n=function(r){r.closed?t.isUserLoggingIn=!1:t.getCookie("flickrToken")?(r.close(),t.getAccessToken.call(t,e)):setTimeout(function(){n(r)},2e3)};if(t.authWindowReference===undefined||t.authWindowReference===null||t.authWindowReference.closed){t.authWindowReference=window.open("","Flickr"+(new Date).getTime(),t.getPopupWindowParams({height:500,width:400})),t.authWindowReference.document.write("redirecting to Flickr"),$(t.authWindowReference).bind("beforeunload",function(e){var n=this;setTimeout(function(){n.closed&&(t.isUserLoggingIn=!1)},500)});var r={action:t.requestTokenUrl,method:"GET",parameters:{oauth_callback:t.callbackUrl}};t.accessObject.access_token=null,t.accessObject.tokenSecret=null;var i=t.signAndReturnUrl(t.requestTokenUrl,r);$.ajax({url:t.proxyUrl,data:{url:i},type:"GET",success:function(e){var r=SBW.Singletons.utils.getJSONFromQueryParams(e);t.accessObject.access_token=r.oauth_token,t.accessObject.tokenSecret=r.oauth_token_secret,t.authWindowReference.document.location.href=t.authorizationUrl+"?oauth_token="+t.accessObject.access_token+"&perms=write",n(t.authWindowReference)},error:function(e){}})}else t.authWindowReference.focus()},checkUserLoggedIn:function(e){var t=this;this.accessObject.access_token!==null&&this.accessObject.access_token!==undefined&&t.isUserLoggingIn?e(!0):e(!1)},signAndReturnUrl:function(e,t){var n=this;return OAuth.completeRequest(t,n.accessObject),OAuth.SignatureMethod.sign(t,n.accessObject),e=e+"?"+OAuth.formEncode(t.parameters),e},uploadRawImage:function(e,t,n){var r=this,i=JSON.parse(JSON.stringify(e));i.forEach(function(e){var i=r.proxyUrl+"?url="+e.file,s=function(i){if(i.length){var s=i.length,o=new ArrayBuffer(s),u=new Uint8Array(o);for(var a=0;a<s;a++)u[a]=i.charCodeAt(a);e.file=new Blob([o],{type:"image/jpeg"}),r.uploadPhoto([e],t,n)}else n(i)};SBW.Singletons.utils.getRawImage(i,s)})},getAccessToken:function(e){var t=this,n=t.getCookie("flickrToken");if(n){var r={action:t.accessTokenUrl,method:"GET",parameters:{oauth_token:t.accessObject.access_token,oauth_verifier:n,perms:"write"}},i=t.signAndReturnUrl(t.accessTokenUrl,r);$.ajax({url:t.proxyUrl,data:{url:i},type:"GET",crossDomain:!0,success:function(n){var r=SBW.Singletons.utils.getJSONFromQueryParams(n);t.accessObject.id=decodeURIComponent(r.user_nsid),t.accessObject.access_token=r.oauth_token,t.accessObject.tokenSecret=r.oauth_token_secret,t.user=new SBW.Models.User({name:r.username,id:decodeURIComponent(r.user_nsid),userImage:"http://flickr.com/buddyicons/"+decodeURIComponent(r.user_nsid)+".jpg"}),t.populateUserInformation.call(t,t.user),t.isUserLoggingIn=!0,e(n)}})}else alert("error in getting access token")},like:function(e,t,n){var r=this,i=function(e,t,n){var i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"POST",parameters:{method:"flickr.favorites.add",perms:"write",format:"json",photo_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:o,type:"POST",dataType:"json"},t,n)},s=function(e,t,n,r){return function(s){s?i(t,n,r):e.startActionHandler(function(){i(t,n,r)})}}(r,e,t,n);r.checkUserLoggedIn(s)},unlike:function(e,t,n){var r=this,i=function(e,t,n){var i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"POST",parameters:{method:"flickr.favorites.remove",perms:"write",format:"json",photo_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:o,type:"POST",dataType:"json"},t,n)},s=function(e,t,n,r){return function(s){s?i(t,n,r):e.startActionHandler(function(){i(t,n,r)})}}(r,e,t,n);r.checkUserLoggedIn(s)},postComment:function(e,t,n,r){var i=this,s=i.accessObject.consumerKey,o=function(e,t,n,r){var o={action:i.flickrApiUrl,method:"POST",parameters:{method:"flickr.photos.comments.addComment",api_key:s,format:"json",photo_id:e.assetId,perms:"write",comment_text:t,oauth_token:i.accessObject.access_token,nojsoncallback:1}},u=i.signAndReturnUrl(i.flickrApiUrl,o);SBW.Singletons.utils.ajax({url:u,type:"POST",dataType:"json"},n,r)},u=function(e,t,n,r){return function(s){s?o(e,t,n,r):i.startActionHandler(function(){o(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(u)},uploadPhoto:function(e,t,n){var r=this;e.forEach(function(e){var i=r.accessObject.consumerKey,s=function(e,t,n){var s={action:r.flickrUploadApiUrl,method:"POST",parameters:{oauth_consumer_key:i,oauth_token:r.accessObject.access_token,oauth_token_secret:r.accessObject.tokenSecret,oauth_callback:r.callbackUrl,title:e.title,description:e.description,is_public:1}},o=r.signAndReturnUrl(r.flickrUploadApiUrl,s),u={url:o,type:"POST",dataType:"xml",processData:!1,fileType:"photo"},a=[{oauth_consumer_key:i,oauth_token:r.accessObject.access_token,photo:e.file,title:e.title,description:e.description,is_public:1}];SBW.api.fileUpload(["flickr"],a,u,t,n)},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(o)})},uploadVideo:function(e,t,n){this.uploadPhoto(e,t,n)},postUpload:function(e,t,n){var r,i;for(i in e)r=e[i];var s=new Array,o=t;r.getElementsByTagName("photoid").length!==0?s.push(new SBW.Models.UploadStatus({id:r.getElementsByTagName("photoid")[0].textContent,serviceName:"flickr",status:"success",rawData:e})):(o=n,s.push(new SBW.Models.Error({message:r.getElementsByTagName("err")[0].getAttribute("msg"),serviceName:"facebook",rawData:e}))),o(s)},getGalleries:function(e,t,n){var r=this,i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"GET",parameters:{method:"flickr.galleries.getList",perms:"write",format:"json",user_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},t,n)},getLikes:function(e,t,n){var r=this,i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"GET",parameters:{method:"flickr.photos.getFavorites",perms:"write",format:"json",photo_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s),u=function(e){if(e.stat==="fail"){var r=new SBW.Models.Error({message:e.message,serviceName:"flickr",rawData:e,code:e.code});n(r)}else{var i=[],s;for(s=0;s<e.photo.person.length;s++){var o=new SBW.Models.User({name:e.photo.person[s].username,id:e.photo.person[s].nsid,userImage:"http://flickr.com/buddyicons/"+e.photo.person[s].nsid+".jpg"});i[s]=new SBW.Models.Like({user:o,rawData:e.photo.person[s]})}var u={serviceName:"flickr",likes:i,likeCount:i.length,rawData:e};t(u)}};SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},u,n)},createGallery:function(e,t,n,r){var i=this,s=i.accessObject.consumerKey,o=function(e,t,n,r){var o={action:i.flickrApiUrl,method:"POST",parameters:{api_key:s,description:t,title:e,format:"json",method:"flickr.galleries.create",oauth_token:i.accessObject.access_token,perms:"write",nojsoncallback:1}},u=i.signAndReturnUrl(i.flickrApiUrl,o);SBW.Singletons.utils.ajax({url:u,type:"POST",dataType:"json"},n,r)},u=function(e,t,n,r){return function(s){s?o(e,t,n,r):i.startActionHandler(function(){o(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(u)},addPhotoToGallery:function(e,t,n,r){var i=this,s=i.accessObject.consumerKey,o=function(e,t,n,r){var o={action:i.flickrApiUrl,method:"POST",parameters:{api_key:s,gallery_id:e,method:"flickr.galleries.addPhoto",format:"json",oauth_token:i.accessObject.access_token,perms:"write",photo_id:t,nojsoncallback:1}},u=i.signAndReturnUrl(i.flickrApiUrl,o);SBW.Singletons.utils.ajax({url:u,type:"POST",dataType:"json"},n,r)},u=function(e,t,n,r){return function(s){s?o(e,t,n,r):i.startActionHandler(function(){o(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(u)},getContacts:function(e,t){var n=this,r=n.accessObject.consumerKey,i=function(e,t){var i={action:n.flickrApiUrl,method:"GET",parameters:{api_key:r,format:"json",method:"flickr.contacts.getList",oauth_token:n.accessObject.access_token,perms:"read",nojsoncallback:1}},s=n.signAndReturnUrl(n.flickrApiUrl,i);SBW.Singletons.utils.ajax({url:s,type:"GET",dataType:"json"},e,t)},s=function(e,t){return function(r){r?i(e,t):n.startActionHandler(function(){i(e,t)})}}(e,t);n.checkUserLoggedIn(s)},getGroups:function(e,t){var n=this,r=function(e,t){var r=n.accessObject.id,i=n.accessObject.consumerKey,s={action:n.flickrApiUrl,method:"GET",parameters:{method:"flickr.people.getGroups",perms:"read",format:"json",api_key:i,nojsoncallback:1}},o=n.signAndReturnUrl(n.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},e,t)},i=function(e,t){return function(i){i?r(e,t):n.startActionHandler(function(){r(e,t)})}}(e,t);n.checkUserLoggedIn(i)},getUserInfo:function(e,t,n){var r=this,i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"GET",parameters:{method:"flickr.people.getInfo",format:"json",user_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},t,n)},getComments:function(e,t,n){var r=this,i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"GET",parameters:{method:"flickr.photos.comments.getList",format:"json",photo_id:e.assetId,api_key:i,nojsoncallback:1}},o=function(e){var n=[];for(var r=0;r<e.comments.comment.length;r++)n[r]=new SBW.Models.Comment({createdTime:e.comments.comment[r].datecreate,fromUser:e.comments.comment[r].authorname,fromUserId:e.comments.comment[r].author,likeCount:null,text:e.comments.comment[r]._content,rawData:e.comments.comment[r],serviceName:"flickr",id:e.comments.comment[r].id,userImage:"http://flickr.com/buddyicons/"+e.comments.comment[r].author+".jpg"});t(n)},u=r.signAndReturnUrl(r.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:u,type:"GET",dataType:"json"},o,n)},getPhotoUrl:function(e,t){var n=this,r=function(e,t){var r=n.accessObject.id,i=n.accessObject.consumerKey,s={action:n.flickrApiUrl,method:"GET",parameters:{method:"flickr.urls.getUserPhotos",format:"json",user_id:r,api_key:i,nojsoncallback:1}},o=n.signAndReturnUrl(n.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},e,t)},i=function(e,t){return function(i){i?r(e,t):n.startActionHandler(function(){r(e,t)})}}(e,t);n.checkUserLoggedIn(i)},getAlbums:function(e,t,n){var r=this;n=n!==undefined?n:r.accessObject.id;var i=function(e,t,n){var i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"GET",parameters:{method:"flickr.photosets.getList",perms:"write",format:"json",user_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s);r.content.length>0?t(r.content):SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},function(e){if(e.stat==="fail"){var i=new SBW.Models.Error({message:e.message,serviceName:"flickr",rawData:e,code:e.code});n(i)}else{var s=e.photosets.photoset;s.forEach(function(e){var t=new SBW.Models.AssetCollection({id:"",title:e.title._content,createdTime:(new Date).getTime(),rawData:e,status:"private",serviceName:"flickr",assets:[],metadata:{dateUpdated:(new Date(e.date_update*1e3)).toDateString(),dateUploaded:(new Date(e.date_create*1e3)).toDateString(),numAssets:e.photos,assetCollectionId:e.id,type:"image",tags:null,fileName:null,description:e.description._content,thumbnail:"http://farm"+e.farm+".staticflickr.com/"+e.server+"/"+e.primary+"_"+e.secret+".jpg",previewUrl:"http://farm"+e.farm+".staticflickr.com/"+e.server+"/"+e.primary+"_"+e.secret+".jpg",author:null,authorAvatar:null,commentCount:e.count_comments,comments:null,likeCount:0,likes:null}});t.id=t.getID(),r.content.push(t)}),t(r.content)}},n)},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(n,e,t);r.checkUserLoggedIn(s)},getAlbumInfo:function(e,t,n){var r=this,i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"GET",parameters:{method:"flickr.photosets.getInfo",perms:"write",format:"json",photoset_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},t,n)},getAlbumComments:function(e,t,n){var r=this,i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"GET",parameters:{method:"flickr.photosets.comments.getList",perms:"write",format:"json",photoset_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},t,n)},getPhotosFromAlbum:function(e,t,n){var r=this,i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"GET",parameters:{method:"flickr.photosets.getPhotos",perms:"write",format:"json",photoset_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s);assetFound=!1,r.content.forEach(function(n,r,i){n.metadata.assetCollectionId===e&&n.assets.length>0&&(t(n.assets),assetFound=!0)}),assetFound||SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},function(i){if(i.stat==="fail"){var s=new SBW.Models.Error({message:i.message,serviceName:"flickr",rawData:i,code:i.code});n(s)}else{var o=new Array,u=i.photoset.photo;u.forEach(function(e){var t=new SBW.Models.ImageAsset({src:"http://farm"+e.farm+".staticflickr.com/"+e.server+"/"+e.id+"_"+e.secret+".jpg",id:"",title:e.title,createdTime:(new Date).getTime(),serviceName:"flickr",rawData:e,status:"private",imgSizes:{t:"",s:"",m:"",l:""},metadata:{caption:null,type:null,dateTaken:null,dateUpdated:null,dateUploaded:null,comments:null,size:null,assetId:e.id,assetCollectionId:i.photoset.id,height:null,width:null,commentCount:null,category:null,exifMake:null,exifModel:null,iptcKeywords:null,orientation:null,tags:null,downloadUrl:null,originalFormat:null,fileName:null,version:null,description:null,thumbnail:null,previewUrl:"http://farm"+e.farm+".staticflickr.com/"+e.server+"/"+e.id+"_"+e.secret+".jpg",author:new SBW.Models.User({name:i.photoset.ownername,id:i.photoset.owner,userImage:"http://flickr.com/buddyicons/"+i.photoset.owner+".jpg"}),authorAvatar:null,likeCount:0,likes:null}});t.id=t.getID(),o.push(t)}),r.content.forEach(function(t){t.metadata.assetCollectionId===e&&(t.assets=o)}),t(o)}},n)},getPhotos:function(e,t){var n=this,r=function(e,t){var r=n.accessObject.id,i=n.accessObject.consumerKey,s=[],o={action:n.flickrApiUrl,method:"GET",parameters:{method:"flickr.people.getPhotos",format:"json",user_id:r,api_key:i,nojsoncallback:1}},u=n.signAndReturnUrl(n.flickrApiUrl,o),a=function(r){if(r.stat==="fail"){var i=new SBW.Models.Error({message:r.message,serviceName:"flickr",rawData:r,code:r.code});t(i)}else{var o=r.photos.photo;for(var u=0;u<o.length;u++)s[u]=new SBW.Models.ImageAsset({src:"http://farm"+o[u].farm+".staticflickr.com/"+o[u].server+"/"+o[u].id+"_"+o[u].secret+".jpg",id:"",title:o[u].title,createdTime:(new Date).getTime(),serviceName:"flickr",rawData:o[u],imgSizes:{t:"",s:"",m:"",l:""},metadata:{caption:null,type:null,dateTaken:null,dateUpdated:null,dateUploaded:null,comments:null,size:null,assetId:o[u].id,assetCollectionId:null,height:null,width:null,commentCount:"",category:null,exifMake:null,exifModel:null,iptcKeywords:null,orientation:"",tags:"",downloadUrl:null,originalFormat:"",fileName:null,version:null,description:"",thumbnail:null,previewUrl:"http://farm"+o[u].farm+".staticflickr.com/"+o[u].server+"/"+o[u].id+"_"+o[u].secret+".jpg",author:new SBW.Models.User({name:n.user.name,id:o[u].owner,userImage:"http://flickr.com/buddyicons/"+
o[u].owner+".jpg"}),authorAvatar:null,likeCount:"",likes:null}}),s[u].id=s[u].getID();e(s)}};SBW.Singletons.utils.ajax({url:u,type:"GET",dataType:"json",processData:!0},a,t)},i=function(e,t){return function(i){i?r(e,t):n.startActionHandler(function(){r(e,t)})}}(e,t);n.checkUserLoggedIn(i)},getPhotoInfo:function(e,t,n){var r=this,i=r.accessObject.consumerKey,s={action:r.flickrApiUrl,method:"GET",parameters:{method:"flickr.photos.getInfo",format:"json",photo_id:e,api_key:i,nojsoncallback:1}},o=r.signAndReturnUrl(r.flickrApiUrl,s);SBW.Singletons.utils.ajax({url:o,type:"GET",dataType:"json"},function(i){if(i.stat==="fail"){var s=new SBW.Models.Error({message:i.message,serviceName:"flickr",rawData:i,code:i.code});n(s)}else{var o=i.photo,u=new SBW.Models.ImageAsset({src:"http://farm"+o.farm+".staticflickr.com/"+o.server+"/"+o.id+"_"+o.secret+".jpg",id:"",title:o.title._content,createdTime:(new Date).getTime(),serviceName:"flickr",rawData:o,status:o.visibility,imgSizes:{t:"",s:"",m:"",l:""},metadata:{caption:null,type:null,dateTaken:(new Date(o.dates.taken*1e3)).toDateString(),dateUpdated:(new Date(o.dates.lastupdate*1e3)).toDateString(),dateUploaded:(new Date(o.dateuploaded*1e3)).toDateString(),comments:null,size:null,assetId:o.id,assetCollectionId:null,height:null,width:null,commentCount:o.comments._content,category:null,exifMake:null,exifModel:null,iptcKeywords:null,orientation:o.rotation,tags:o.tags,downloadUrl:null,originalFormat:o.originalformat,fileName:null,version:null,description:o.description._content,thumbnail:null,previewUrl:"http://farm"+o.farm+".staticflickr.com/"+o.server+"/"+o.id+"_"+o.secret+".jpg",author:new SBW.Models.User({name:o.owner.username,id:o.owner.nsid,userImage:"http://flickr.com/buddyicons/"+o.owner.nsid+".jpg"}),authorAvatar:null,likeCount:o.isfavorite,likes:null}});u.id=u.getID(),r.content.forEach(function(t){t.assets.forEach(function(t,n,r){t.metadata.assetId===e&&(r[n]=u)})}),t(u)}},n)},getProfilePic:function(e,t,n){var r=this;e=e?e:r.accessObject.id;if(e){var i="http://flickr.com/buddyicons/"+e+".jpg";t(i)}else n()},logoutHandler:function(e){var t=this;t.accessObject.access_token=null,t.accessObject.id=null,e()}}),SBW.Controllers.Services.GooglePlus=SBW.Controllers.Services.ServiceController.extend({name:"googleplus",icon:"googleplus",title:"Google Plus",init:function(){var e=SBW.Singletons.config.services.GooglePlus.clientID,t=SBW.Singletons.utils.callbackURLForService("GooglePlus");this.accessObject={clientId:e,callbackUrl:t,accessTokenUrl:"https://accounts.google.com/o/oauth2/auth?client_id="+e+"&scope=https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/plus.me&response_type=token&redirect_uri="+t,access_token:null,apiKey:SBW.Singletons.config.services.GooglePlus.apiKey,baseURL:"https://www.googleapis.com/plus/v1"}},startActionHandler:function(e){var t=this,n=function(r){r.closed||(t.getCookie("googleplusToken")?(r.close(),t.getAccessToken.call(t,e)):setTimeout(function(){n(r)},2e3))};t.authWindowReference===null||t.authWindowReference.closed?(t.authWindowReference=window.open(t.accessObject.accessTokenUrl,"googleplus"+(new Date).getTime(),t.getPopupWindowParams({height:500,width:400})),n(t.authWindowReference)):t.authWindowReference.focus()},checkUserLoggedIn:function(e){var t=this,n=t.accessObject.access_token,r="https://accounts.google.com/o/oauth2/tokeninfo?v=2.1&access_token="+n;$.getJSON(r,"callback=?",function(t){t.error?e(!1):e(!0)})},getAccessToken:function(e){var t=this,n=t.getCookie("googleplusToken");n!="undefined"&&(t.accessObject.access_token=n,e())},_getData:function(e,t){var n=this,r=n.accessObject.baseURL;e.method==="list"?e.type==="activities"?r+="/people/"+e.id+"/activities/public":e.type==="comments"&&(r+="/activities/"+e.id+"/comments"):e.method==="get"&&(r+="/"+e.type+"/"+e.id),r+="?key="+n.accessObject.apiKey,e.nextPageToken&&(r+="&pageToken="+e.nextPageToken),$.getJSON(r,"callback=?",function(e){t(e)})},_getAllData:function(e,t,n){var r=this,i=[],s=function(t,n){return function(o){if(o&&!o.error){if(o.items)for(var u=0,a=o.items.length;u<a;u++)i.push(o.items[u]);else i.push(o);o.nextPageToken?(e.nextPageToken=o.nextPageToken,r._getData(e,s)):(i=i.length==1?i[0]:i,t&&t(i))}else n&&n(o)}}(t,n);r._getData(e,s)},getPosts:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"activities",method:"list",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"activities",method:"list",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getComments:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"comments",method:"list",id:e.assetId},t,n):r.startActionHandler(function(){r._getAllData({type:"comments",method:"list",id:e.assetId},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getProfile:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"people",method:"get",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"people",method:"get",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getPostByID:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"activities",method:"get",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"activities",method:"get",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)},getCommentByID:function(e,t,n){var r=this,i=function(t,n){return function(i){i?r._getAllData({type:"comments",method:"get",id:e},t,n):r.startActionHandler(function(){r._getAllData({type:"comments",method:"get",id:e},t,n)})}}(t,n);r.checkUserLoggedIn(i)}}),SBW.Controllers.Services.LinkedIn=SBW.Controllers.Services.ServiceController.extend({name:"linkedin",icon:"linkedin",title:"linkedin",linkedInInit:!1,init:function(){this.accessObject={appId:SBW.Singletons.config.services.LinkedIn.apiKey,token:null},this.setup()},setup:function(){var e=this;$(document).ready(function(){var t=document.createElement("script"),n=!1;t.src="//platform.linkedin.com/in.js?async=true",t.onload=t.onreadystatechange=function(){!n&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(n=!0,IN.init({api_key:e.accessObject.appId,scope:"r_network rw_nus r_fullprofile",authorize:!0}),t.onload=t.onreadystatechange=null,e.linkedInInit=!0)};var r=document.getElementsByTagName("head")[0]||document.documentElement;r.insertBefore(t,r.firstChild)})},startActionHandler:function(e){var t=this;t.linkedInInit&&IN.User?IN.User.isAuthorized()?e():IN.User.authorize(function(t){e()}):setTimeout(function(){t.startActionHandler()},1e3)},checkUserLoggedIn:function(e){var t=this;t.linkedInInit&&IN.User?IN.User.isAuthorized()?e(!0):e(!1):setTimeout(function(){t.checkUserLoggedIn(e)},1e3)},publishMessage:function(e,t,n){var r=this,i=function(e,t,n){IN.API.Raw("/people/~/current-status").method("PUT").body(JSON.stringify(e)).result(function(e){t({id:"n/a",serviceName:"linkedin"},e)}).error(function(e){var t=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});SBW.logger.debug("Could not publish message"),n(t)})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},postComment:function(e,t,n,r){var i=this,s=function(e,t,n,r){var i={comment:t};IN.API.Raw("/people/~/network/updates/key="+e+"/update-comments").method("POST").body(JSON.stringify(i)).result(function(e){n(e)}).error(function(e){var t=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});SBW.logger.debug("Could not post message"),r(t)})},o=function(e,t,n,r){return function(o){o?s(e,t,n,r):i.startActionHandler(function(){s(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(o)},like:function(e,t,n){var r=this,i=function(e,t,n){IN.API.Raw("/people/~/network/updates/key="+e+"/is-liked").method("PUT").body("true").result(function(e){t(e)}).error(function(e){n(e)})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},unlike:function(e,t,n){var r=this,i=function(e,t,n){IN.API.Raw("/people/~/network/updates/key="+e+"/is-liked").method("PUT").body("false").result(function(e){t(e)}).error(function(e){n(e)})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},share:function(e,t,n){var r=this,i=function(e,t,n){IN.UI.Share().params({url:e}).place()},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getShareCount:function(e,t,n){var r=this;if(r.linkedInInit&&IN.Tags){var i=function(e){t({count:e})};IN.Tags.Share.getCount(e,i)}else setTimeout(function(){r.getShareCount(e,t,n)},1e3)},getComments:function(e,t,n){var r=this,i=function(e,t,n){IN.API.Raw("/people/~/network/updates/key="+e.assetId+"/update-comments").result(function(e){var n=[],r=e.values;for(var i=0;i<r.length;i++)n[i]=new SBW.Models.Comment({createdTime:r[i].timestamp,fromUser:r[i].person.firstName+" "+r[i].person.lastName,likeCount:null,text:r[i].comment,rawData:r[i],serviceName:"linkedin",id:r[i].id,userImage:r[i].person.pictureUrl});t(n)}).error(function(e){var t=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});n(t)})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getCommentsForUrl:function(e,t,n){},getLikes:function(e,t,n){var r=this,i=function(e,t,n){IN.API.Raw("/people/~/network/updates/key="+e+"/likes").result(function(e){var n=[],r=e.values;for(var i=0;i<r.length;i++){var s=new SBW.Models.User({name:r[i].person.firstName+" "+r[i].person.lastName,id:r[i].person.id,userImage:r[i].person.pictureUrl});n[i]=new SBW.Models.Like({user:s,rawData:r[i]})}var o={serviceName:"linkedin",likes:n,likeCount:n.length,rawData:e};t(o)}).error(function(e){var t=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});n(t)})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getPosts:function(e,t,n){e=e||"me";var r=this,i=function(t,n){IN.API.MemberUpdates(e).result(function(e){t(e.values)}).error(function(e){var t=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});n(t)})},s=function(e,t){return function(n){n?i(e,t):r.startActionHandler(function(){i(e,t)})}}(t,n);r.checkUserLoggedIn(s)},getRecentPostId:function(e,t,n){e=e||"me";var r=this,i=function(t,n){IN.API.MemberUpdates(e).result(function(e){t(e.values[0].updateKey)}).error(function(e){var t=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});n(t)})},s=function(e,t){return function(n){n?i(e,t):r.startActionHandler(function(){i(e,t)})}}(t,n);r.checkUserLoggedIn(s)},getFriends:function(e,t,n){var r=this,i=function(e,t){IN.API.Raw("people/~/connections").result(function(t){e(JSON.stringify(t))}).error(function(e){var n=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});t(n)})},s=function(e,t){return function(n){n?i(e,t):r.startActionHandler(function(){i(e,t)})}}(t,n);r.checkUserLoggedIn(s)},follow:function(e,t,n){var r=this,i=function(t,n){var r="/people/~/following/companies",i={id:e},s=!1;IN.API.Raw().url(r).result(function(o){o.values&&o.values.forEach(function(i){Number(e)===Number(i.id)&&(s=!0,IN.API.Raw().url(r+"/id="+e).method("DELETE").result(function(e){setTimeout(function(){t(e)},1e3)}).error(function(e){n(e)}))}),s||IN.API.Raw().url(r).method("POST").body(JSON.stringify(i)).result(function(e){setTimeout(function(){t(e)},1e3)}).error(function(e){n(e)})}).error(function(e){n(e)})},s=function(e,t){return function(n){n?i(e,t):r.startActionHandler(function(){i(e,t)})}}(t,n);r.checkUserLoggedIn(s)},getFollowCount:function(e,t,n){var r=this,i="companies/"+e+":(num-followers)";r.linkedInInit&&IN.API?IN.API.Raw().url(i).result(function(e){t({count:e.numFollowers,serviceName:"linkedin"})}).error(function(e){var t=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});n(t)}):setTimeout(function(){r.getFollowCount(e,t,n)},1e3)},getRecommendCount:function(e,t,n){var r=this,i={id:e},s="/companies/"+e+"/products:(id,name,type,num-recommendations,recommendations:(recommender))";r.linkedInInit&&IN.API?IN.API.Raw().url(s).result(function(e){t(e)}).error(function(e){n(e)}):setTimeout(function(){r.getRecommendCount(e,t,n)},1e3)},getProfile:function(e,t,n){e=e||"me";var r=this,i=function(t,n){IN.API.Profile(e).fields(["id","firstName","lastName","pictureUrl"]).result(function(e){var n=e.values[0],r={id:n.id,name:n.firstName+" "+n.lastName,photoUrl:n.pictureUrl};t(r)}).error(function(e){var t=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});n(t)})},s=function(e,t){return function(n){n?i(e,t):r.startActionHandler(function(){i(e,t)})}}(t,n);r.checkUserLoggedIn(s)},getProfilePic:function(e,t,n){e=e||"me";var r=this,i=function(t,n){IN.API.Profile(e).fields(["pictureUrl"]).result(function(e){var n=e.values[0];t(n.pictureUrl)}).error(function(e){var t=new SBW.Models.Error({message:e.message,serviceName:"linkedin",rawData:e,code:e.errorCode});n(t)})},s=function(e,t){return function(n){n?i(e,t):r.startActionHandler(function(){i(e,t)})}}(t,n);r.checkUserLoggedIn(s)}}),SBW.Controllers.Services.Picasa=SBW.Controllers.Services.ServiceController.extend({name:"picasa",icon:"picasa",title:"Picasa",content:[],collectionSetRawData:null,init:function(){var e=SBW.Singletons.config.services.Picasa.clientID,t=SBW.Singletons.utils.callbackURLForService("Picasa");this.accessObject={clientId:e,accessTokenUrl:"https://accounts.google.com/o/oauth2/auth?client_id="+e+"&scope=https://picasaweb.google.com/data&response_type=token&redirect_uri="+t,access_token:null,apiKey:null},this.baseUrl="https://picasaweb.google.com/data",this.feedUrl=this.baseUrl+"/feed/api/user/default",this.entryUrl=this.baseUrl+"/entry/api/user/default"},startActionHandler:function(e){var t=this,n=function(r){r.closed||(t.getCookie("picasaToken")?(r.close(),t.getAccessToken.call(t,e)):setTimeout(function(){n(r)},2e3))};t.authWindowReference===undefined||t.authWindowReference===null||t.authWindowReference.closed?(t.authWindowReference=window.open(t.accessObject.accessTokenUrl,"picasa"+(new Date).getTime(),t.getPopupWindowParams({height:500,width:400})),n(t.authWindowReference)):t.authWindowReference.focus()},checkUserLoggedIn:function(e){var t=this,n=t.accessObject.access_token,r="https://accounts.google.com/o/oauth2/tokeninfo?v=2.1&access_token="+n;SBW.Singletons.utils.ajax({url:r,type:"GET",dataType:"jsonp"},function(n){n.error?(t.eraseCookie("picasaToken"),e(!1)):e(!0)},function(n){t.eraseCookie("picasaToken"),e(!1)})},getAccessToken:function(e){var t=this,n=t.getCookie("picasaToken");n!=="undefined"&&(t.accessObject.access_token=n,e())},_generateMultipart:function(e,t,n,r,i){i||(n=new Uint8Array(n));var s=["Media multipart posting","   \n","--END_OF_PART","\n","Content-Type: application/atom+xml","\n","\n","<entry xmlns='http://www.w3.org/2005/Atom'>","<title>",e,"</title>","<summary>",t,"</summary>",'<category scheme="http://schemas.google.com/g/2005#kind" term="http://schemas.google.com/photos/2007#photo" />',"</entry>","\n","--END_OF_PART","\n","Content-Type:",r,"\n\n"].join(""),o="\n--END_OF_PART--",u=i?n.length:n.byteLength,a=s.length+u+o.length,f=new Uint8Array(a),l=0,c=0;for(l;l<s.length;l+=1)f[l]=s.charCodeAt(l)&255;for(c;c<u;l+=1,c+=1)f[l]=i?n.charCodeAt(c):n[c];for(c=0;l<a;l+=1,c+=1)f[l]=o.charCodeAt(c)&255;return f.buffer},getAlbums:function(e,t){var n=this,r=function(e,t){var r={action:n.feedUrl,method:"GET",parameters:{kind:"album",access:"all",alt:"json",access_token:n.accessObject.access_token}},i=n.feedUrl+"?access_token="+n.accessObject.access_token+"&alt=json";n.content.length>0?e(n.content):SBW.Singletons.utils.ajax({url:i,crossDomain:!1,type:"GET",dataType:"jsonp"},function(t){var r=null;n.content=[],t.feed.entry&&$.each(t.feed.entry,function(e,i){r=new SBW.Models.AssetCollection({title:this.title.$t,createdTime:(new Date).getTime(),status:this.gphoto$access.$t,serviceName:"picasa",metadata:{dateUpdated:(new Date(this.updated.$t)).toDateString(),dateUploaded:(new Date(this.published.$t)).toDateString(),numAssets:this.gphoto$numphotos.$t,assetCollectionId:this.gphoto$id.$t,commentCount:this.gphoto$commentCount.$t,thumbnail:this.media$group.media$thumbnail[0].url||"",fileName:this.gphoto$name.$t,description:this.summary.$t,author:this.author[0].name.$t}}),r.id=r.getID(),n.content.push(r),n.collectionSetRawData=t}),e(n.content)},t)},i=function(e,t){return function(n){r(e,t)}}(e,t);n.startActionHandler(i)},uploadPhoto:function(e,t,n){var r=this,i=e.length,s=function(e,t,n){var s=r.feedUrl+"/albumid/default?access_token="+r.accessObject.access_token+"&alt=json",o=SBW.Singletons.config.proxyURL+"?url="+encodeURIComponent(s),u=[];$.each(e,function(){var e=this,s=new FileReader;s.onload=function(e){return function(s){SBW.Singletons.utils.ajax({url:o,data:r._generateMultipart(e.title,e.description,s.target.result,e.file.type,!1),contentType:'multipart/related; boundary="END_OF_PART"',crossDomain:!1,type:"POST",dataType:"json",processData:!1},function(e){u.push(new SBW.Models.UploadStatus({serviceName:"picasa",id:e.entry.gphoto$id.$t,rawData:e})),u.length===i&&t(u)},function(){u.push(new SBW.Models.Error({serviceName:"picasa",rawData:value})),u.length===e.length&&n(u)})}}(e),s.readAsArrayBuffer(e.file)})},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(o)},uploadVideo:function(e,t,n){var r=this;r.uploadPhoto(e,t,n)},_formatMedia:function(e){var t=new SBW.Models.ImageAsset({title:e.title.$t,createdTime:e.gphoto$timestamp.$t,rawData:e,serviceName:"picasa",src:e.content.src,metadata:{dateUpdated:(new Date(e.updated.$t)).toDateString(),downloadUrl:e.content.src,dateUploaded:(new Date(e.published.$t)).toDateString(),size:e.gphoto$size.$t,assetId:e.gphoto$id.$t,assetCollectionId:e.gphoto$albumid.$t,height:e.gphoto$height.$t,width:e.gphoto$width.$t,commentCount:e.gphoto$commentCount.$t,originalFormat:e.content.type,version:e.gphoto$imageVersion.$t,description:e.summary.$t,author:e.media$group.media$credit[0].$t}});return t.id=t.getID(),t},postComment:function(e,t,n,r){var i=this,s=function(e,t,n,r){var s=i.feedUrl+"/albumid/"+t.assetCollectionId+"/photoid/"+t.assetId+"?access_token="+i.accessObject.access_token+"&alt=json",o=SBW.Singletons.config.proxyURL+"?url="+encodeURIComponent(s),u="<?xml version='1.0' encoding='UTF-8'?> <entry xmlns='http://www.w3.org/2005/Atom'><content>"+e+"</content><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/photos/2007#comment' /></entry>";SBW.Singletons.utils.ajax({url:o,data:u,contentType:"application/atom+xml",crossDomain:!1,type:"POST",processData:!1},n,r)},o=function(e,t,n,r){return function(o){o?s(e,t,n,r):i.startActionHandler(function(){s(e,t,n,r)})}}(t,e,n,r);i.checkUserLoggedIn(o)},getComments:function(e,t,n){var r=this,i=function(e,t,n){var i=r.feedUrl+"/albumid/"+e.assetCollectionId+"/photoid/"+e.assetId+"?access_token="+r.accessObject.access_token+"&alt=json",s=r.getAsset("picasa",e.assetCollectionId,e.assetId);s===undefined||s.metadata.comments===null||s.metadata.comments===undefined?SBW.Singletons.utils.ajax({url:i,crossDomain:!1,type:"GET",dataType:"json"},function(n){var i=[];n.feed.entry&&($.each(n.feed.entry,function(e,t){var n=new SBW.Models.Comment;n.text=t.content.$t,n.createdTime=t.updated.$t,n.fromUser=t.author[0].name.$t,n.fromUserId=t.author[0].gphoto$user.$t,i.push(n)}),r._populateComments(e.assetCollectionId,e.assetId,i)),t(i)},n):t(s.metadata.commentsArray)},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getPhotosFromAlbum:function(e,t,n){var r=this,i=function(e,t,n){var i=r.feedUrl+"/albumid/"+e+"?access_token="+r.accessObject.access_token+"&alt=json",s=!1;r.content.forEach(function(n,r,i){n.metadata.assetCollectionId===e&&n.assets.length>0&&(t(n.assets),s=!0)}),s||SBW.Singletons.utils.ajax({url:i,crossDomain:!1,type:"GET",dataType:"json"},function(e){var n=[];e.feed.entry&&($.each(e.feed.entry,function(e,t){n.push(r._formatMedia(t))}),r._populateAssets(e.feed.gphoto$id.$t,n)),t(n)},n)},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},createAlbum:function(e,t,n,r){var i=this,s=function(e,t,n,r){var s=i.feedUrl+"?access_token="+i.accessObject.access_token+"&alt=json",o=SBW.Singletons.config.proxyURL+"?url="+encodeURIComponent(s),u="<?xml version='1.0' encoding='UTF-8'?> <entry xmlns='http://www.w3.org/2005/Atom' xmlns:media='http://search.yahoo.com/mrss/' xmlns:gphoto='http://schemas.google.com/photos/2007'><title type='text'>"+e+"</title><summary type='text'>"+t+"</summary><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/photos/2007#album' /></entry>";SBW.Singletons.utils.ajax({url:o,data:u,contentType:"application/atom+xml",crossDomain:!1,type:"POST"},n,r)},o=function(e,t,n,r){return function(o){o?s(e,t,n,r):i.startActionHandler(function(){s(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(o)},deleteAlbum:function(e,t,n){var r=this,i=function(e,t,n){var i=r.entryUrl+"/albumid/"+e+"?access_token="+r.accessObject.access_token+"&alt=json",s=SBW.Singletons.config.proxyURL+"?url="+encodeURIComponent(i);SBW.Singletons.utils.ajax({url:s,crossDomain:!1,type:"DELETE",customHeaders:{"Gdata-Version":"2","If-match":"*"}},t,n)},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getProfilePic:function(e,t,n){var r=this,i=function(e,t){var n=r.collectionSetRawData.feed;n.gphoto$thumbnail.$t?e(n.gphoto$thumbnail.$t):t()};r.collectionSetRawData?i(t,n):r.getAlbums(function(e){i(t,n)},n)},logout:function(e,t){var n=this;n.accessObject.token=null,n.eraseCookie("picasaToken"),n.content=[],e()},uploadRawImage:function(e,t,n){var r=this,i=e.length,s=function(e,t,n){var s=r.feedUrl+"/albumid/default?access_token="+r.accessObject.access_token+"&alt=json",o=SBW.Singletons.config.proxyURL+"?url="+encodeURIComponent(s),u=[];$.each(e,function(){var s=this,a=function(a){SBW.Singletons.utils.ajax({url:o,data:r._generateMultipart(s.title,s.description,a,"image/jpeg",!0),contentType:'multipart/related; boundary="END_OF_PART"',crossDomain:!1,type:"POST",dataType:"json",processData:!1},function(e){u.push(new SBW.Models.UploadStatus({serviceName:"picasa",id:e.entry.gphoto$id.$t,rawData:e})),u.length===i&&t(u)},function(t){u.push(new SBW.Models.Error({serviceName:"picasa",rawData:t})),u.length===e.length&&n(u)})},f=SBW.Singletons.config.proxyURL+"?url="+s.file;SBW.Singletons.utils.getRawImage(f,a)})},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(o)},_populateAssets:function(e,t){var n=this;$.each(n.content,function(){if(this.metadata.assetCollectionId===e)return this.assets=t,!1})},_populateComments:function(e,t,n){var r=this;r.content.forEach(function(r,i,s){r.metadata.assetCollectionId===e&&r.assets.forEach(function(e,r,i){if(e.metadata.assetId===t)return e.metadata.comments=n,e})})}}),SBW.Controllers.Services.Twitter=SBW.Controllers.Services.ServiceController.extend({name:"twitter",icon:"twitter",title:"Twitter",init:function(){this.callbackUrl=SBW.Singletons.utils.callbackURLForService("twitter"),this.proxyUrl=SBW.Singletons.config.proxyURL,this.apiVersionUrl="https://api.twitter.com/1.1",this.postUrl=this.apiVersionUrl+"/statuses/update.json",this.shareUrl=this.apiVersionUrl+"/statuses/retweet/",this.homeTimelineUrl=this.apiVersionUrl+"/statuses/home_timeline.json",this.mentionsTimelineUrl=this.apiVersionUrl+"/statuses/mentions_timeline.json",this.apiSearchUrl=this.apiVersionUrl+"/search/tweets.json",this.userTimelineUrl=this.apiVersionUrl+"/statuses/user_timeline.json",this.accountSettingsUrl=this.apiVersionUrl+"/account/settings.json",this.profileUrl=this.apiVersionUrl+"/users/show.json",this.countUrl="http://cdn.api.twitter.com/1/urls/count.json",this.followUrl=this.apiVersionUrl+"/friendships/create.json",this.unfollowUrl=this.apiVersionUrl+"/friendships/destroy.json",this.followStatusUrl=this.apiVersionUrl+"/friendships/show.json",this.likeUrl=this.apiVersionUrl+"/favorites/create.json",this.unlikeUrl=this.apiVersionUrl+"/favorites/destroy.json",this.requestTokenUrl="http://api.twitter.com/oauth/request_token",this.authorizeUrl="http://api.twitter.com/oauth/authorize",this.accessTokenUrl="http://api.twitter.com/oauth/access_token",this.getPostUrl="https://api.twitter.com/1.1/statuses/show/",this.accessObject={consumerKey:SBW.Singletons.config.services.Twitter.consumerKey,consumerSecret:SBW.Singletons.config.services.Twitter.consumerSecret,user_id:null},this.user=new SBW.Models.User({})},startActionHandler:function(e){var t=this;t.eraseCookie("twitterToken");var n=function(r){r.closed?t.isUserLoggingIn=!1:t.getCookie("twitterToken")?(r.close(),t.getAccessToken.call(t,e)):setTimeout(function(){n(r)},2e3)};if(t.authWindowReference===null||t.authWindowReference.closed||t.authWindowReference===undefined){t.authWindowReference=window.open("","Twitter"+(new Date).getTime(),t.getPopupWindowParams({height:500,width:400})),t.authWindowReference.document.write("redirecting to Twitter"),$(t.authWindowReference).bind("beforeunload",function(e){var n=this;setTimeout(function(){n.closed&&(t.isUserLoggingIn=!1)},500)});var r={action:this.requestTokenUrl,method:"GET",parameters:{oauth_callback:t.callbackUrl}};t.accessObject.access_token=null,t.accessObject.tokenSecret=null;var i=t.signAndReturnUrl(this.requestTokenUrl,r);this.sendTwitterRequest({url:i,returnType:"text"},function(e){var r=SBW.Singletons.utils.getJSONFromQueryParams(e);t.accessObject.access_token=r.oauth_token,t.accessObject.tokenSecret=r.oauth_token_secret,t.authWindowReference.document.location.href=t.authorizeUrl+"?oauth_token="+t.accessObject.access_token+"&perms=write",n(t.authWindowReference)},function(e){console.log("Error: ",e)})}else t.authWindowReference.focus()},checkUserLoggedIn:function(e){this.accessObject.tokenSecret&&this.accessObject.access_token&&this.isUserLoggingIn?e(!0):e(!1)},signAndReturnUrl:function(e,t){var n=this;return OAuth.completeRequest(t,n.accessObject),OAuth.SignatureMethod.sign(t,n.accessObject),e=e+"?"+OAuth.formEncode(t.parameters),e},getAccessToken:function(e){var t=this,n=t.getCookie("twitterToken");if(n){var r={action:this.accessTokenUrl,method:"GET",parameters:{oauth_token:t.accessObject.access_token,oauth_verifier:n}},i=t.signAndReturnUrl(this.accessTokenUrl,r);this.sendTwitterRequest({url:i,returnType:"text"},function(n){var r=SBW.Singletons.utils.getJSONFromQueryParams(n);t.accessObject.user_id=r.user_id,t.accessObject.access_token=r.oauth_token,t.accessObject.tokenSecret=r.oauth_token_secret,t.user.id=r.user_id,t.user.screenName=r.screen_name,t.isUserLoggingIn=!0,t.user.id!==undefined&&e()},function(e){console.log("Error: ",e)})}else console.log("error in getting access token")},logoutHandler:function(e){var t=this;t.accessObject.access_token=null,t.accessObject.nsid=null},sendTwitterRequest:function(e,t,n){var r=this,i,s,o,u={},a;if(e.header){s=e.header.length;for(i=0;i<s;i++)o=e.header[i].split(":"),o.length===2&&(u[o[0]]=o[1])}a={url:r.proxyUrl+"?url="+encodeURIComponent(e.url),type:e.type||"GET",data:e.parameters||"",customHeaders:u,contentType:e.contentType,processData:e.processData,dataType:e.returnType||"json"},SBW.Singletons.utils.ajax(a,t,n)},getAuthorizationHeader:function(e){var t=this,n=e.parameters;n.push(["oauth_consumer_key",t.accessObject.consumerKey]),n.push(["oauth_nonce",OAuth.nonce(32)]),n.push(["oauth_signature_method","HMAC-SHA1"]),n.push(["oauth_timestamp",OAuth.timestamp()]),n.push(["oauth_token",t.accessObject.access_token]),n.push(["oauth_version","1.0"]);var r={consumerSecret:t.accessObject.consumerSecret,tokenSecret:t.accessObject.tokenSecret};OAuth.SignatureMethod.sign(e,r);var i=OAuth.SignatureMethod.normalizeParameters(e.parameters),s=OAuth.SignatureMethod.getBaseString(e),o=OAuth.getParameter(e.parameters,"oauth_signature"),u=OAuth.getAuthorizationHeader("",e.parameters);return"Authorization: "+u},getDataForRequest:function(e,t,n){var r=[],i;if(t)for(i in t)t.hasOwnProperty(i)&&r.push([i,t[i]]);var s={action:e,method:n,parameters:r},o=this.getAuthorizationHeader(s);return{url:e+(n==="GET"?"?"+OAuth.formEncode(t):""),type:n,header:[o],parameters:n==="GET"?"":t}},getHomeTimeLine:function(e,t,n){var r=this,i,s=function(e,t,n){i=r.getDataForRequest(r.homeTimelineUrl,e,"GET"),r.sendTwitterRequest(i,t,n)},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(o)},getMentionsTimeLine:function(e,t,n){var r=this,i,s=function(e,t,n){i=r.getDataForRequest(r.mentionsTimelineUrl,e,"GET"),r.sendTwitterRequest(i,t,n)},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(o)},searchTweets:function(e,t,n){var r,i="";if(e){for(r in e)e.hasOwnProperty(r)&&(e[r]=encodeURIComponent(e[r]),i+=r+"="+e[r]+"&");i=i.slice(0,i.lastIndexOf("&"))}var s={url:"https://search.twitter.com/search.json?"+i,type:"GET",header:"",parameters:""};this.sendTwitterRequest(s,t,n)},search:function(e,t,n){var r=this,i,s=function(e,t,n){i=r.getDataForRequest(r.apiSearchUrl,e,"GET"),r.sendTwitterRequest(i,t,n)},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(o)},getUserTimeline:function(e,t,n){var r=this,i,s=function(e,t,n){i=r.getDataForRequest(r.userTimelineUrl,e,"GET"),r.sendTwitterRequest(i,t,n)},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(o)},getAccountSettings:function(e,t){var n=this,r,i=function(e,t){r=n.getDataForRequest(n.accountSettingsUrl,null,"GET"),n.sendTwitterRequest(r,e,t)},s=function(e,t){return function(r){r?i(e,t):n.startActionHandler(function(){i(e,t)})}}(e,t);n.checkUserLoggedIn(s)},publishMessage:function(e,t,n){var r=this,i={status:e},s=function(e,t,n){var i=r.getDataForRequest(r.postUrl,e,"POST");r.sendTwitterRequest(i,function(e){t({id:e.id,serviceName:"twitter"},e)},function(e){var t=new SBW.Models.Error;t.message=JSON.parse(e.responseText).errors[0].message,t.code=JSON.parse(e.responseText).errors[0].code,t.serviceName="twitter",t.rawData=JSON.parse(e.responseText),n(t)})},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(i,t,n);r.checkUserLoggedIn(o)},getLikes:function(e,t,n){var r={serviceName:"twitter",likes:null,likeCount:null,message:undefined,rawData:""};t(r)},getPost:function(e,t,n){if(e.id){var r=this.getDataForRequest(this.getPostUrl+e.id+".json",e,"GET");this.sendTwitterRequest(r,t,n)}else n(null)},updateWithMedia:function(e,t,n){var r=this,i=[];e.forEach(function(e){var s=new FormData,o,u=e.file,a={};s.append("media[]",u),a.status=e.title+" - "+e.description;for(o in a)a.hasOwnProperty(o)&&(i.push([o,a[o]]),s.append(o,a[o]));var f={action:"https://api.twitter.com/1.1/statuses/update_with_media.json",method:"POST",parameters:i},l=r.getAuthorizationHeader(f),c=OAuth.formEncode(a),h={url:"https://api.twitter.com/1.1/statuses/update_with_media.json?"+c,header:[l],type:"POST",parameters:s,processData:!1,contentType:!1},p=function(e){var n=[];n.push(new SBW.Models.UploadStatus({id:e.id,serviceName:"twitter",status:"success",rawData:e})),t(n)};r.sendTwitterRequest(h,p,n)})},uploadPhoto:function(e,t,n){this.updateWithMedia(e,t,n)},getProfilePic:function(e,t,n){var r=this,i={};r.user.userImage?t(r.user.userImage):(e?i.user_id=e:r.user.id?i.user_id=r.user.id:r.user.screenName&&(i.screen_name=r.user.screenName),r.getProfile(i,function(){t(r.user.userImage)},n))},getProfile:function(e,t,n){var r=this,i;if(r.user.id&&r.user.name&&r.user.screenName&&r.user.userImage)t(r.user);else{var s=function(e,t,n){i=r.getDataForRequest(r.profileUrl,e,"GET"),r.sendTwitterRequest(i,function(e){r.user.id=e.id,r.user.name=e.name,r.user.screenName=e.screen_name,r.user.userImage=e.profile_image_url,t(e)},n)},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(o)}},follow:function(e,t,n){var r=this;r.checkFollowStatus(e,function(i){i===!0?r.unSubscribe({screen_name:e},t,function(e){n(new SBW.Models.Error({serviceName:"twitter"
}))}):r.subscribe({screen_name:e},t,function(e){n(new SBW.Models.Error({serviceName:"twitter"}))})},function(e){SBW.logger.error("In checkFollowStatus method - Twitter")})},checkFollowStatus:function(e,t,n){var r=this,i,s=function(e,t,n){i=r.getDataForRequest(r.followStatusUrl,{source_screen_name:r.user.screenName,target_screen_name:e},"GET"),r.sendTwitterRequest(i,function(e){t(e.relationship.target.followed_by)},function(e){n(new SBW.Models.Error({serviceName:"twitter"}))})},o=function(e,t,n){return function(i){i?s(e,t,n):r.startActionHandler(function(){s(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(o)},getFollowCount:function(e,t,n){var r=this,i=function(e,t,n){var i=r.getDataForRequest(r.profileUrl,{screen_name:e},"GET");r.sendTwitterRequest(i,function(e){t({count:e.followers_count,serviceName:"twitter"})},function(e){n(new SBW.Models.Error({serviceName:"twitter"}))})},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getShareCount:function(e,t,n){var r={url:this.countUrl+("?"+OAuth.formEncode({url:e})),type:"GET",header:[],parameters:""};this.sendTwitterRequest(r,t,n)},getCount:function(e,t,n){var r={url:this.countUrl+("?"+OAuth.formEncode(e)),type:"GET",header:[],parameters:""};this.sendTwitterRequest(r,t,n)},share:function(e,t,n,r){var i=this,s,o=function(e,t,n,r){s=i.getDataForRequest(i.shareUrl+e+".json",t,"POST"),i.sendTwitterRequest(s,n,r)},u=function(e,t,n,r){return function(s){s?o(e,t,n,r):i.startActionHandler(function(){o(e,t,n,r)})}}(e,t,n,r);i.checkUserLoggedIn(u)},unSubscribe:function(e,t,n){var r=this.getDataForRequest(this.unfollowUrl,e,"POST");this.sendTwitterRequest(r,t,n)},subscribe:function(e,t,n){var r=this.getDataForRequest(this.followUrl,e,"POST");this.sendTwitterRequest(r,t,n)},like:function(e,t,n){var r={id:e},i=this,s=function(e,t,n){var r=i.getDataForRequest(i.likeUrl,e,"POST"),s=function(e){if(JSON.parse(e.responseText).errors[0]["code"]==139){var t={message:JSON.parse(e.responseText).errors[0].message};n(t)}},o=function(e){var n={message:e.favorited?"You have successfully favorited this status/page.":"Try again"};t(n)};i.sendTwitterRequest(r,o,s)},o=function(e,t,n){return function(r){r?s(e,t,n):i.startActionHandler(function(){s(e,t,n)})}}(r,t,n);i.checkUserLoggedIn(o)},unlike:function(e,t,n){var r={id:e},i=this,s=function(e,t,n){var r=i.getDataForRequest(i.unlikeUrl,e,"POST");i.sendTwitterRequest(r,t,n)},o=function(e,t,n){return function(r){r?s(e,t,n):i.startActionHandler(function(){s(e,t,n)})}}(r,t,n);i.checkUserLoggedIn(o)},getCommentsForUrl:function(e,t,n){var r={q:e.url,rpp:e.limit||10,page:Math.ceil(e.offset/e.limit)||1};this.searchTweets(r,function(e){var n=[],r,i,s=e.results,o;for(i in s)s.hasOwnProperty(i)&&(o=s[i],o.created_at&&o.from_user&&o.text&&o.profile_image_url&&(r=new SBW.Models.Comment({createdTime:o.created_at,fromUser:o.from_user,likeCount:0,text:o.text,userImage:o.profile_image_url,serviceName:"twitter"}),n.push(r)));t(n)},n)}}),SBW.Controllers.Services.Instagram=SBW.Controllers.Services.ServiceController.extend({name:"instagram",icon:"instagram",isPhotoSetSupported:!1,authWindowReference:null,content:[],init:function(){var e=SBW.Singletons.config.services.Instagram.apiKey,t=SBW.Singletons.utils.callbackURLForService("instagram");this.apiUrl="https://api.instagram.com/v1/",this.accessObject={clientId:e,callbackUrl:t,accessTokenUrl:"http://api.instagram.com/oauth/authorize/?client_id="+e+"&redirect_uri="+t+"&response_type=token"+"&scope=likes+comments",access_token:null}},startActionHandler:function(e){var t=this;t.eraseCookie("instagramToken"),t.accessObject.access_token=null;var n=function(r){r.closed?t.isUserLoggingIn=!1:t.getCookie("instagramToken")?(r.close(),t.accessObject.access_token=t.getCookie("instagramToken"),e()):setTimeout(function(){n(r)},2e3)};t.authWindowReference===null||t.authWindowReference.closed?(t.authWindowReference=window.open(t.accessObject.accessTokenUrl,"Instagram"+(new Date).getTime(),t.getPopupWindowParams({width:800,height:300})),n(t.authWindowReference)):t.authWindowReference.focus()},checkUserLoggedIn:function(e){var t=this,n=t.accessObject.access_token,r="https://api.instagram.com/v1/users/self/?access_token="+n;SBW.Singletons.utils.ajax({url:r,type:"GET",dataType:"jsonp"},function(t){t.meta.code===200?e(!0):e(!1)})},getProfile:function(e,t,n){e=e!==undefined?e:"self";var r=this,i=function(t,n){SBW.Singletons.utils.ajax({url:r.apiUrl+"/users/"+e,type:"GET",dataType:"jsonp",data:{access_token:r.accessObject.access_token}},function(e){if(e.meta.code===200){var r=new SBW.Models.User({name:e.data.full_name,id:e.data.id,userImage:e.data.profile_picture,rawData:e});t(r)}else{var i=new SBW.Models.Error({message:e.meta.error_message,serviceName:"instagram",rawData:e,code:e.meta.code});n(i)}},n)},s=function(e,t){return function(n){n?i(e,t):r.startActionHandler(function(){i(e,t)})}}(t,n);r.checkUserLoggedIn(s)},getComments:function(e,t,n){var r=this,i=function(e,t,n){SBW.Singletons.utils.ajax({url:r.apiUrl+"/media/"+e.assetId+"/comments",type:"GET",dataType:"jsonp",data:{access_token:r.accessObject.access_token}},t,n)},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},like:function(e,t,n){var r=this,i=function(e,t,n){SBW.Singletons.utils.ajax({url:SBW.Singletons.config.proxyURL+"?url="+r.apiUrl+"/media/"+e+"/likes",type:"POST",data:{access_token:r.accessObject.access_token}},t,n)},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},unlike:function(e,t,n){var r=this,i=function(e,t,n){SBW.Singletons.utils.ajax({url:SBW.Singletons.config.proxyURL+"?url="+r.apiUrl+"/media/"+e+"/likes?access_token="+r.accessObject.access_token,type:"DELETE"},t,n)},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getLikes:function(e,t,n){var r=this,i=function(e,t,n){SBW.Singletons.utils.ajax({url:r.apiUrl+"/media/"+e+"/likes",type:"GET",dataType:"jsonp",data:{access_token:r.accessObject.access_token}},function(e){if(e.meta.code===200){var r=[],i,s;for(i=0;i<e.data.length;i++)s=new SBW.Models.User({name:e.data[i].full_name,id:e.data[i].id,userImage:e.data[i].profile_picture}),r[i]=new SBW.Models.Like({user:s,rawData:e.data[i]});var o={serviceName:"instagram",likes:r,likeCount:r.length,rawData:e};t(o)}else{var u=new SBW.Models.Error({message:e.meta.error_message,serviceName:"instagram",rawData:e,code:e.meta.code});n(u)}},n)},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getMedia:function(e,t,n){var r=this,i=function(e,t,n){r.content.length>0?t(r.content[0].assets):SBW.Singletons.utils.ajax({url:r.apiUrl+"/users/"+e+"/media/recent",data:{access_token:r.accessObject.access_token},type:"GET",dataType:"jsonp"},function(e){if(e.meta.code===200){var r=new Array,i=e.data;i.forEach(function(e){var t=new SBW.Models.ImageAsset({id:"",src:e.images.standard_resolution.url,title:e.caption===null?null:e.caption.text,createdTime:(new Date).getTime(),serviceName:"instagram",rawData:e,status:"private",imgSizes:{t:e.images.thumbnail.url,s:e.images.thumbnail.url,m:e.images.low_resolution.url,l:e.images.standard_resolution.url},metadata:{caption:e.caption,type:e.type,dateTaken:(new Date(e.created_time*1e3)).toDateString(),dateUpdated:null,dateUploaded:null,comments:null,size:null,assetId:e.id,assetCollectionId:null,height:e.images.standard_resolution.height,width:e.images.standard_resolution.width,commentCount:e.comments.count,category:null,exifMake:null,exifModel:null,iptcKeywords:null,orientation:null,tags:e.tags,downloadUrl:e.images.standard_resolution.url,originalFormat:null,fileName:null,version:null,description:e.caption,thumbnail:e.images.thumbnail.url,previewUrl:e.images.standard_resolution.url,author:new SBW.Models.User({name:e.user.full_name,id:e.user.id,userImage:e.user.profile_picture}),authorAvatar:null,likeCount:e.likes.count,likes:e.likes.data}}),n=e.comments.data,i=new Array,s=e.likes.data,o=new Array;t.id=t.getID(),n.forEach(function(e){var t=new SBW.Models.Comment({text:e.text,id:e.id,createdTime:e.created_time,fromUser:e.from.full_name,likeCount:null,userImage:e.from.profile_picture,rawData:e,serviceName:"instagram"});i.push(t)}),t.metadata.comments=i,s.forEach(function(e){var t=new SBW.Models.Like({user:new SBW.Models.User({name:e.full_name,id:e.id,userImage:e.profile_picture}),rawData:e});o.push(t)}),t.metadata.likes=o,r.push(t)}),t(r)}else{var s=new SBW.Models.Error({message:e.meta.error_message,serviceName:"instagram",rawData:e,code:e.meta.code});n(s)}},n)},s=function(e,t,n){return function(s){s?i(e,t,n):r.startActionHandler(function(){i(e,t,n)})}}(e,t,n);r.checkUserLoggedIn(s)},getAlbums:function(e,t,n){var r=n||"self",i=this,s=function(t){var n=new SBW.Models.AssetCollection({title:"",createdTime:(new Date).getTime(),serviceName:"instagram",assets:t,metadata:{numAssets:t.length,assetCollectionId:"",thumbnail:t[0].metadata.thumbnail||"",author:t[0].metadata.author.name}});n.id=n.getID(),i.content.push(n),e(i.content)};i.content.length>0?e(i.content):i.getMedia(r,s,t)},getPhotosFromAlbum:function(e,t,n){var r=e||"self";this.getMedia(r,t,n)}});